<!DOCTYPE html>
<!--
MIT License

Copyright (c) 2025 GRIFORTIS

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

==========================================================================
‚ö†Ô∏è WARNING: EXPERIMENTAL SOFTWARE ‚ö†Ô∏è
==========================================================================

This is an experimental, open-source project. Do NOT use it for important
assets at this stage.

TERMS OF USE & LIABILITY DISCLAIMER:

1. You must be offline.
   This tool is designed for air-gapped environments only. Disconnect from
   all networks before proceeding.

2. You must use a secure environment.
   For maximum security, use a temporary, trusted operating system (e.g.,
   Tails) or a fresh OS install on a secure computer.

3. You are 100% responsible.
   GRIFORTIS and its contributors are not responsible for any loss of funds,
   data corruption, or any other damages that may result from using this
   software. Use at your own risk.
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRIFORTIS ¬∑ Schiavinato Sharing (Air-Gapped)</title>
    
    <!-- FONTS: use only local system fonts, no external references -->

    <style>
        /* ==========================================================================
        GRIFORTIS - DESIGN SYSTEM (v0.1.0)
        ==========================================================================
        */

        :root {
            /* --- 1. BRAND COLORS (FIXED) --- */
            --brand-navy: #0B1019;
            --brand-titanium: #E3E4E6;
            --cyber-gold: #F4B400;
            --error-red: #FF4444;
            --success-green: #00E676; /* "Signal Green" for success */

            /* --- 2. DARK THEME (DEFAULT) --- */
            --bg-main: var(--brand-navy);
            --bg-card: #151E2E;
            --text-main: var(--brand-titanium);
            --text-muted: #8A8D91;
            --border-color: #2C3E50;
            --input-bg: rgba(0,0,0,0.3);
            --input-text: #fff;
            --shadow-color: rgba(0,0,0,0.5);
            
            --btn-disabled-bg: #2C3E50;
            --btn-disabled-text: #586376;
            --btn-cancel-border: #4A5568;
            
            --alert-error-bg: #3b1f1f;
            --alert-error-border: #7a2c2c;
            --alert-error-text: #fecaca;
            
            --alert-success-bg: #113a29;
            --alert-success-border: #1a6445;
            --alert-success-text: #bbf7d0;
            
            color-scheme: dark;
        }

        /* --- 3. LIGHT THEME (ALTERNATE) --- */
        [data-theme="light"] {
            --bg-main: #F0F2F5;
            --bg-card: #FFFFFF;
            --text-main: var(--brand-navy);
            --text-muted: #5E6C84;
            --border-color: #D1D5DB;
            --input-bg: #F7F9FC;
            --input-text: var(--brand-navy);
            --shadow-color: rgba(0,0,0,0.1);
            
            --btn-disabled-bg: #E2E8F0;
            --btn-disabled-text: #A0AEC0;
            --btn-cancel-border: #CBD5E0;
            
            --alert-error-bg: #FEEEEE;
            --alert-error-border: #FCA5A5;
            --alert-error-text: #7f1d1d;
            
            --alert-success-bg: #E6F8F2;
            --alert-success-border: #6EE7B7;
            --alert-success-text: #064e3b;
            
            color-scheme: light;
        }

        /* --- 4. BASIC RESET AND TRANSITIONS --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background-color: var(--bg-main);
            color: var(--text-main);
            /* Font stack using local system fonts only */
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            font-weight: 400;
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* --- 5. TYPOGRAPHY (VOICE) --- */
        h1, h2, h3, h4 {
            /* Headings using bold system fonts */
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            font-weight: 800;
            text-transform: uppercase;
            color: var(--text-main);
            letter-spacing: 0.5px;
            margin-bottom: 0.5em;
        }
        h1 { font-size: 2.5rem; }
        h2 { font-size: 1.75rem; /*margin-top: 2em;*/ }
        h3 { font-size: 1.25rem; font-weight: 700; margin-top: 1.5em; }
        h4 { font-size: 1rem; font-weight: 700; margin-top: 1em; }
        p { font-size: 1rem; margin-bottom: 1em; }
        code, .mono { 
            /* Monospaced text using common local system fonts only */
            font-family: "SF Mono", Menlo, Consolas, "Liberation Mono", monospace; 
            background: var(--input-bg);
            padding: 0.2em 0.4em;
            border-radius: 4px;
            font-size: 0.9em;
        }
        a { 
            color: var(--cyber-gold); 
            text-decoration: none; 
            border-bottom: 1px dashed var(--cyber-gold);
            transition: all 0.2s;
        }
        a:hover { color: var(--text-main); border-bottom: 1px solid var(--text-main); }
        hr { border: 0; border-top: 1px solid var(--border-color); margin: 2em 0; }

        /* --- 6. LAYOUT (CONTAINERS) --- */
        .container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding: 15px 0;
            margin-bottom: 20px;
        }
        .header h1 { 
            font-size: 1.5rem; margin: 0; 
            background: -webkit-linear-gradient(45deg, var(--text-main), var(--text-muted));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .connection-status {
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
            padding: 5px 10px;
            border-radius: 6px;
            margin-left: 20px;
        }
        .connection-status.online {
            color: #000;
            background-color: var(--error-red);
        }
        .connection-status.offline {
            color: var(--text-muted);
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
        }
        .theme-toggle {
            background: var(--bg-card); border: 1px solid var(--border-color); color: var(--text-main);
            padding: 8px 16px; border-radius: 50px; cursor: pointer; font-weight: 600;
            font-size: 0.9rem; display: flex; gap: 8px; align-items: center;
        }
        .component-card {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px var(--shadow-color);
            margin-bottom: 20px;
        }
        
        /* --- 7. FORMS (INPUT FIELDS) --- */
        .form-group { margin-bottom: 1rem; }
        label { 
            display: block; font-size: 0.9rem; 
            /* Labels use the same system font stack as the body */
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            font-weight: 600; 
            color: var(--text-muted); margin-bottom: 8px; 
        }
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="date"],
        select {
            width: 100%;
            padding: 12px;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--input-text);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--cyber-gold);
            box-shadow: 0 0 0 2px rgba(244, 180, 0, 0.3);
        }
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: var(--bg-main) invert(1);
        }
        [data-theme="light"] input[type="date"]::-webkit-calendar-picker-indicator {
            filter: none;
        }
        
        /* Custom checkbox & radio controls */
        .choice-group { display: flex; align-items: center; margin-bottom: 10px; }
        .choice-group input { opacity: 0; width: 0; height: 0; }
        .choice-group label {
            display: flex; align-items: center; cursor: pointer;
            font-family: 'Inter', sans-serif; font-weight: 400;
            color: var(--text-main);
        }
        .choice-group label::before {
            content: '';
            width: 18px; height: 18px;
            border: 2px solid var(--border-color);
            background: var(--input-bg);
            margin-right: 12px;
            transition: all 0.2s;
        }
        /* Checkbox */
        input[type="checkbox"] + label::before { border-radius: 4px; }
        input[type="checkbox"]:checked + label::before {
            background-color: var(--cyber-gold);
            border-color: var(--cyber-gold);
            content: '‚úì'; /* Checkmark */
            color: #000;
            font-weight: 900;
            text-align: center;
            line-height: 15px;
        }
        /* Radio */
        input[type="radio"] + label::before { border-radius: 50%; }
        input[type="radio"]:checked + label::before {
            background-color: var(--bg-card);
            border-color: var(--cyber-gold);
            box-shadow: inset 0 0 0 4px var(--cyber-gold); /* Center dot */
        }
        
        /* --- 8. BUTTONS (ACTIONS) --- */
        .btn {
            width: auto; padding: 12px 24px; border-radius: 6px;
            /* Buttons use bold system font for strong visual hierarchy */
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            font-weight: 800; font-size: 0.9rem;
            text-transform: uppercase; cursor: pointer; border: none;
            transition: all 0.2s; margin: 5px;
        }
        /* Primary button (gold) */
        .btn-primary {
            background-color: var(--cyber-gold);
            color: #000;
            box-shadow: 0 4px 15px rgba(244, 180, 0, 0.2);
        }
        .btn-primary:not(:disabled):hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn-primary:disabled {
            background-color: var(--btn-disabled-bg);
            color: var(--btn-disabled-text);
            cursor: not-allowed;
            box-shadow: none;
        }
        /* Secondary button (ghost / cancel) */
        .btn-secondary {
            background-color: transparent;
            border: 1px solid var(--btn-cancel-border);
            color: var(--text-muted);
            font-weight: 700;
        }
        .btn-secondary:hover { border-color: var(--text-main); color: var(--text-main); }
        
        /* --- 9. MESSAGES & ALERTS --- */
        .alert {
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid transparent;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        /* Success (green) */
        .alert-success {
            background-color: var(--alert-success-bg);
            border-color: var(--alert-success-border);
            color: var(--alert-success-text);
        }
        /* Error (red) */
        .alert-error {
            background-color: var(--alert-error-bg);
            border-color: var(--alert-error-border);
            color: var(--alert-error-text);
        }
        
        /* --- 10. DISCLAIMER / FOOTER --- */
        .disclaimer {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 2rem;
            border-top: 1px solid var(--border-color);
            padding-top: 1.5rem;
        }

        /* Custom style for seed word inputs */
        .seed-word-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .seed-word-row label {
            font-family: "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
            color: var(--text-muted);
            width: 30px; /* fixed width for alignment */
            text-align: right;
            margin-bottom: 0; /* Override default label margin */
        }
        .seed-word-row input {
            flex-grow: 1;
        }

        /* Page 2: Share Card Refinements */
        .share-card h3 {
            margin-top: 0;
        }
        .share-metadata {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 0.5rem 2rem;
            margin: 1.5rem 0;
        }
        .share-metadata p {
            margin-bottom: 0.5em;
        }

        .share-word-container {
            background: var(--input-bg);
            padding: 20px;
            border-radius: 8px;
        }
        .share-word-list {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px 10px; /* Increased vertical gap */
        }
        .share-word-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .share-word-item label {
            font-family: "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
            color: var(--text-muted);
            width: 30px; /* fixed width for alignment */
            text-align: right;
            flex-shrink: 0;
        }
        .share-word-item code.mono {
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: center;
            border-radius: 6px; /* Match input fields */
            flex-grow: 1;
            width: 100%;
        }

        /* Autocomplete & Validation Styles */
        #autocomplete-suggestions {
            position: absolute;
            border: 1px solid var(--border-color);
            background-color: var(--bg-card);
            box-shadow: 0 4px 20px var(--shadow-color);
            border-radius: 8px;
            z-index: 1001;
            max-height: calc(100vh - 40px); /* Limit height to viewport with some padding */
            min-width: 200px; /* Give it a minimum width */
            overflow-y: auto;
        }
        .autocomplete-suggestion {
            padding: 10px;
            cursor: pointer;
            font-family: "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
        }
        .autocomplete-suggestion.autocomplete-active {
            background-color: var(--input-bg);
            color: var(--cyber-gold);
        }
        input.invalid {
            border-color: var(--error-red) !important;
            box-shadow: 0 0 0 2px rgba(255, 68, 68, 0.3) !important;
        }

        /* Sub-header Styles */
        .flow-subheader {
            font-size: 1.25rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--text-muted);
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        /* Landing Page Specific Styles */
        #pageLanding .component-card ul {
            padding-left: 25px; /* Indent the list */
            margin-top: 1em;
        }
        #pageLanding .component-card li {
            margin-bottom: 1em; /* Add space between list items */
        }

        /* Home Page Styles */
        .home-button {
            display: block;
            width: 100%;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background-color: var(--bg-card);
            color: var(--text-main);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .home-button:hover {
            border-color: var(--cyber-gold);
            transform: translateY(-3px);
            box-shadow: 0 4px 20px var(--shadow-color);
        }
        .home-button h2 {
            font-size: 1.75rem;
            margin: 0 0 10px 0;
        }
        .home-button p {
            font-size: 1rem;
            color: var(--text-muted);
            margin: 0;
        }

        /* Recover Page Styles */
        .horizontal-radio-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .share-input-container {
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: var(--bg-card);
        }
        .share-input-container h3 {
            margin-top: 0;
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
        }

        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 5px 25px rgba(0,0,0,0.5);
            width: 90%;
            max-width: 450px;
            text-align: center;
        }
        .modal-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        /* --- 11. PRINT STYLES --- */
        @media print {
            /* Hide all screen elements and show only the dedicated print container */
            body > .container, .header, .disclaimer, .modal-overlay, .theme-toggle {
                display: none;
            }
            #print-output {
                display: block;
            }
            
            /* Force light theme colors for better readability and ink saving */
            body {
                --bg-main: #FFFFFF;
                --bg-card: #FFFFFF;
                --text-main: #0B1019;
                --text-muted: #5E6C84;
                --border-color: #AEB5BC;
                --input-bg: #F0F2F5;
                --input-text: var(--brand-navy);
                --shadow-color: transparent;
            }
            
            /* General print setup */
            body, .container {
                width: 100%;
                margin: 0;
                padding: 0;
            }

            /* Reset card styles for printing */
            .component-card {
                box-shadow: none;
                border: 1px solid var(--border-color);
                margin-bottom: 20px;
            }
            
            /* Page break logic for each share inside the print container */
            #print-output .share-card {
                break-before: page; /* Modern property */
                page-break-before: always; /* Older property */
            }

            /* Prevent page break on the first share card */
            #print-output .share-card:first-child {
                break-before: auto;
                page-break-before: auto;
            }

            /* Hide on-screen buttons inside the share display area if any exist */
            #shares-output .btn, #btn-back-to-create1, #btn-start-over-create {
                 display: none;
            }
        }

    </style>
</head>
<body>

    <div class="container">
        <!-- ==========================================================================
        HEADER
        - Contains the main title, the online status indicator, and theme toggle.
        - This header is persistent across all pages.
        ========================================================================== -->
        <header class="header">
            <div style="display: flex; align-items: center;">
                <h1>Schiavinato Sharing</h1>
                <div id="connection-status" class="connection-status"></div>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()">
                <span id="toggle-icon">‚òÄÔ∏è</span> <span id="toggle-text">Light Mode</span>
            </button>
        </header>

        <!-- ==========================================================================
        MAIN CONTENT WRAPPER
        - Contains all application "pages". Only one page is visible at a time.
        ========================================================================== -->
        <main>
            <!-- ==========================================================================
            PAGE -1: LANDING & DISCLAIMER
            - The very first page the user sees.
            - Forces the user to acknowledge the risks before proceeding.
            ========================================================================== -->
            <section id="pageLanding">
                <div class="component-card">
                    <h2 style="color: var(--error-red); text-align: center;">‚ö†Ô∏è WARNING: EXPERIMENTAL SOFTWARE ‚ö†Ô∏è</h2>
                    <p style="text-align: center; font-weight: 600;">
                        This is an experimental, open-source project. Do NOT use it for important assets at this stage.
                    </p>
                    <hr>
                    <h3>Terms of Use & Liability Disclaimer</h3>
                    <ul>
                        <li><strong>You must be offline.</strong> This tool is designed for air-gapped environments only. Disconnect from all networks before proceeding.</li>
                        <li><strong>You must use a secure environment.</strong> For maximum security, use a temporary, trusted operating system (e.g., Tails) or a fresh OS install on a secure computer.</li>
                        <li><strong>You are 100% responsible.</strong> GRIFORTIS and its contributors are not responsible for any loss of funds, data corruption, or any other damages that may result from using this software. Use at your own risk.</li>
                    </ul>
                    <hr>
                    <div class="form-group" style="margin-top: 20px;">
                        <div class="choice-group">
                            <input type="checkbox" id="disclaimer-checkbox">
                            <label for="disclaimer-checkbox">I have read the warnings, I know exactly what I'm doing, and I'm aware of the risks.</label>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button id="btn-continue-to-home" class="btn btn-primary" disabled>Continue</button>
                    </div>
                </div>
            </section>
            
            <!-- This container will hold the sub-header for the flows -->
            <h2 id="flow-subheader" class="flow-subheader" style="display: none;"></h2>

            <!-- ==========================================================================
            PAGE 0: HOME
            - The main entry point of the application.
            - Provides navigation to the two primary flows: Create and Recover.
            ========================================================================== -->
            <section id="pageHome" style="display: none;">
                <button class="home-button" id="btn-go-to-recover">
                    <h2>Recover Wallet</h2>
                    <p>Enter the data from the shares and recover the wallet</p>
                </button>
                <button class="home-button" id="btn-go-to-create">
                    <h2>Create Shares</h2>
                    <p>Enter the data from the wallet and create the shares</p>
                </button>
            </section>
            
            <!-- ==========================================================================
            PAGE 1: CREATE SHARES - DATA INPUT
            - The first step in the "Create Shares" flow.
            - Collects all necessary data from the user.
            ========================================================================== -->
            <section id="pageCreate1" style="display: none;">
                
                <!-- Section 1.1: Wallet Metadata -->
                <div class="component-card">
                    <h2>1. Identification and Date</h2>
                    <div style="display: flex; gap: 20px;">
                        <!-- Wallet Identifier Input -->
                        <div class="form-group" style="flex: 2;">
                            <label for="wallet-identifier">Wallet Identifier (Optional)</label>
                            <input type="text" id="wallet-identifier" class="mono" placeholder="E.g., Main Wallet" maxlength="40">
                        </div>
                        <!-- Creation Date Input -->
                        <div class="form-group" style="flex: 1;">
                            <label for="creation-date">Creation Date</label>
                            <input type="date" id="creation-date" class="mono">
                        </div>
                    </div>
                </div>

                <!-- Section 1.2: Sharding Scheme Selection -->
                <div class="component-card">
                    <h2>2. Splitting Scheme (Sharding)</h2>
                    <div style="display: flex; gap: 30px;">
                        <!-- Scheme Radio Buttons -->
                        <div class="form-group" style="flex: 1;">
                            <label>Select scheme</label>
                            <div class="choice-group">
                                <input type="radio" id="scheme-2of3" name="scheme" value="2of3" checked>
                                <label for="scheme-2of3">2-of-3 (Default)</label>
                            </div>
                            <div class="choice-group">
                                <input type="radio" id="scheme-2of4" name="scheme" value="2of4">
                                <label for="scheme-2of4">2-of-4</label>
                            </div>
                            <div class="choice-group">
                                <input type="radio" id="scheme-3of5" name="scheme" value="3of5">
                                <label for="scheme-3of5">3-of-5 (Sovereign)</label>
                            </div>
                        </div>
                        <!-- Dynamic Scheme Explanation -->
                        <div id="scheme-explanation" style="flex: 2; background: var(--input-bg); padding: 20px; border-radius: 8px; border: 1px solid var(--border-color);">
                            <!-- Explanation is dynamically inserted here by JS -->
                        </div>
                    </div>
                </div>

                <!-- Section 1.3: Seed Phrase Input -->
                <div class="component-card">
                    <h2>3. Seed Phrase</h2>
                    <!-- Word Count Toggle -->
                    <div class="form-group" style="text-align: center;">
                        <button id="btn-12-words" class="btn btn-secondary">12 Words</button>
                        <button id="btn-24-words" class="btn btn-primary">24 Words</button>
                    </div>
                    <!-- Container for dynamic seed word inputs -->
                    <div id="seed-word-inputs" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                        <!-- Inputs are dynamically inserted here by JS -->
                    </div>
                </div>

                <!-- Page 1 Footer Buttons -->
                <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                    <button class="btn btn-secondary btn-back-home">Back to Home</button>
                    <button id="btn-generate-shares" class="btn btn-primary">Generate Shares</button>
                </div>
            </section>

            <!-- ==========================================================================
            PAGE 2: CREATE SHARES - DISPLAY
            - The second step in the "Create Shares" flow.
            - Displays the generated shares ready for printing or transcription.
            ========================================================================== -->
            <section id="pageCreate2" style="display: none;">

                <!-- Instructions and Print Button -->
                <div class="component-card">
                    <h2>Shares Generated</h2>
                    <p>Your shares are ready. Transcribe or print them and store them in a safe place. <strong>All data shown below must be transcribed onto each corresponding share.</strong></p>
                    <div class="alert alert-error">
                        <strong>ATTENTION:</strong> This data will not be saved. After closing this page, it will be gone forever. Double-check everything before you leave.
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Print Shares</button>
                    </div>
                </div>

                <!-- Container for dynamically generated share cards -->
                <div id="shares-output">
                    <!-- Example of a single share card -->
                    <div class="component-card share-card">
                        <h3>Share 1 of 3</h3>
                        <hr>
                        <div class="share-metadata">
                            <p><strong>Wallet Identifier:</strong> Main Wallet</p>
                            <p><strong>Creation Date:</strong> 2025-11-21</p>
                            <p><strong>Share Number (X):</strong> 1</p>
                            <p><strong>Scheme Threshold (K):</strong> 2</p>
                            <p><strong>Original Seed Phrase Length:</strong> 24</p>
                            <p><strong>Master Verification:</strong> <code class="mono">abandon - 0001</code></p>
                        </div>
                        <h4 style="margin-top: 25px; margin-bottom: 10px; color: var(--text-muted); font-weight: 600;">Encrypted Seed Phrase (Y) - Not a real BIP39 seed phrase</h4>
                        <div class="share-word-container">
                            <div class="share-word-list">
                                <div class="share-word-item"><label>1.</label><code class="mono">hospital - 0876</code></div>
                                <div class="share-word-item"><label>2.</label><code class="mono">spray - 1654</code></div>
                                <div class="share-word-item"><label>3.</label><code class="mono">logic - 1042</code></div>
                                <div class="share-word-item"><label>C1.</label><code class="mono">lemon - 1014</code></div>
                                <div class="share-word-item"><label>4.</label><code class="mono">manual - 1083</code></div>
                                <div class="share-word-item"><label>5.</label><code class="mono">forward - 0721</code></div>
                                <div class="share-word-item"><label>6.</label><code class="mono">vehicle - 1959</code></div>
                                <div class="share-word-item"><label>C2.</label><code class="mono">glass - 0789</code></div>
                            </div>
                        </div>
                    </div>
                    <!-- End of example -->
                </div>

                <!-- Page 2 Footer Buttons -->
                <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                    <button id="btn-back-to-create1" class="btn btn-secondary">‚Üê Go Back and Edit</button>
                    <button id="btn-start-over-create" class="btn btn-primary">Clear All & Start Over</button>
                </div>
            </section>

            <!-- ==========================================================================
            PAGE 3: RECOVER WALLET - DATA INPUT
            - The first step in the "Recover Wallet" flow.
            - Dynamically generates input fields based on user's scheme selection.
            ========================================================================== -->
            <section id="pageRecover1" style="display: none;">
                <!-- Section 3.1: Recovery Parameters -->
                <div class="component-card">
                    <h2>1. Enter Recovery Parameters</h2>
                    <div style="display: flex; gap: 30px; align-items: flex-end;">
                        <!-- Scheme Threshold Selection -->
                        <div class="form-group" style="flex: 1;">
                            <label>Scheme Threshold (K)</label>
                            <div class="horizontal-radio-group">
                                <div class="choice-group">
                                    <input type="radio" id="recover-k-2" name="recover-k" value="2" checked>
                                    <label for="recover-k-2">2</label>
                                </div>
                                <div class="choice-group">
                                    <input type="radio" id="recover-k-3" name="recover-k" value="3">
                                    <label for="recover-k-3">3</label>
                                </div>
                            </div>
                        </div>
                        <!-- Word Count Toggle -->
                        <div class="form-group" style="flex: 2;">
                            <label>Original Seed Phrase Length</label>
                            <div>
                                <button id="recover-btn-12-words" class="btn btn-secondary">12 Words</button>
                                <button id="recover-btn-24-words" class="btn btn-primary">24 Words</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 3.2: Dynamic Share Inputs -->
                <div id="recover-shares-container">
                    <!-- Share input blocks are dynamically inserted here by JS -->
                </div>

                <!-- Page 3 Footer Buttons -->
                <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                    <button class="btn btn-secondary btn-back-home">Back to Home</button>
                    <button id="btn-recover-wallet" class="btn btn-primary">Recover Wallet</button>
                </div>
            </section>

            <!-- ==========================================================================
            PAGE 4: RECOVER WALLET - DISPLAY
            - The second step in the "Recover Wallet" flow.
            - Displays the successfully recovered original seed phrase.
            ========================================================================== -->
            <section id="pageRecover2" style="display: none;">
                <!-- Success Message and Print Button -->
                <div class="component-card">
                    <h2>Wallet Recovered</h2>
                    <div class="alert alert-success">
                        <strong>SUCCESS:</strong> The original seed phrase has been recovered.
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Print Recovered Seed</button>
                    </div>
                </div>

                <!-- Recovered Seed Phrase Display -->
                <div class="component-card">
                    <h4 style="margin-top: 0; margin-bottom: 15px; color: var(--text-muted); font-weight: 600;">Original BIP39 Seed Phrase</h4>
                    <div class="share-word-list" style="grid-template-columns: repeat(3, 1fr);">
                        <!-- Example for 24 words -->
                        <div class="share-word-item"><label>1.</label><code class="mono">abandon</code></div>
                        <div class="share-word-item"><label>2.</label><code class="mono">ability</code></div>
                        <div class="share-word-item"><label>3.</label><code class="mono">able</code></div>
                        <div class="share-word-item"><label>4.</label><code class="mono">about</code></div>
                        <div class="share-word-item"><label>5.</label><code class="mono">above</code></div>
                        <div class="share-word-item"><label>6.</label><code class="mono">absent</code></div>
                        <div class="share-word-item"><label>7.</label><code class="mono">absorb</code></div>
                        <div class="share-word-item"><label>8.</label><code class="mono">abstract</code></div>
                        <div class="share-word-item"><label>9.</label><code class="mono">absurd</code></div>
                        <div class="share-word-item"><label>10.</label><code class="mono">abuse</code></div>
                        <div class="share-word-item"><label>11.</label><code class="mono">access</code></div>
                        <div class="share-word-item"><label>12.</label><code class="mono">accident</code></div>
                        <div class="share-word-item"><label>13.</label><code class="mono">account</code></div>
                        <div class="share-word-item"><label>14.</label><code class="mono">accuse</code></div>
                        <div class="share-word-item"><label>15.</label><code class="mono">achieve</code></div>
                        <div class="share-word-item"><label>16.</label><code class="mono">acid</code></div>
                        <div class="share-word-item"><label>17.</label><code class="mono">acoustic</code></div>
                        <div class="share-word-item"><label>18.</label><code class="mono">acquire</code></div>
                        <div class="share-word-item"><label>19.</label><code class="mono">across</code></div>
                        <div class="share-word-item"><label>20.</label><code class="mono">act</code></div>
                        <div class="share-word-item"><label>21.</label><code class="mono">action</code></div>
                        <div class="share-word-item"><label>22.</label><code class="mono">actor</code></div>
                        <div class="share-word-item"><label>23.</label><code class="mono">actress</code></div>
                        <div class="share-word-item"><label>24.</label><code class="mono">actual</code></div>
                    </div>
                </div>

                 <!-- Page 4 Footer Buttons -->
                 <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                    <button id="btn-back-to-recover1" class="btn btn-secondary">‚Üê Go Back and Edit</button>
                    <button id="btn-start-over-recover" class="btn btn-primary">Clear All & Start Over</button>
                </div>
            </section>

            <!-- ==========================================================================
            DISCLAIMER / FOOTER
            - Persistent footer for all pages.
            ========================================================================== -->
            <footer class="disclaimer">
                <p style="text-align: center; font-weight: 600; margin: 0;">
                    ¬© 2025 GRIFORTIS. Released under the MIT License. v0.1.0
                </p>
            </footer>
        </main>
    </div>

    <!-- ==========================================================================
    PRINT-ONLY OUTPUT
    - A dedicated container for generating a clean, printable version of shares.
    - Populated by JavaScript and only made visible via print media queries.
    ========================================================================== -->
    <div id="print-output" style="display: none;"></div>

    <!-- ==========================================================================
    MODAL DIALOG
    - A custom confirmation dialog to replace native browser prompts.
    - Controlled by the `showConfirmationModal` function in JavaScript.
    ========================================================================== -->
    <div id="custom-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3 id="modal-title">Are you sure?</h3>
            <p id="modal-text">This action cannot be undone.</p>
            <div class="modal-buttons">
                <button id="modal-cancel" class="btn btn-secondary">Cancel</button>
                <button id="modal-confirm" class="btn btn-primary">Confirm</button>
            </div>
        </div>
    </div>

    <!-- ==========================================================================
    AUTOCOMPLETE SUGGESTIONS CONTAINER
    - A single, reusable floating container for autocomplete suggestions.
    - It is positioned and populated by JavaScript.
    ========================================================================== -->
    <div id="autocomplete-suggestions" style="display: none;"></div>

    <!-- ==========================================================================
    SHA-256 LIBRARY (Embedded for offline use)
    - Adapted from js-sha256 v0.9.0 (MIT License) https://github.com/emn178/js-sha256
    - Provides a pure-JavaScript SHA-256 implementation that works in air-gapped sessions.
    ========================================================================== -->
    <script>
        (function (root) {
            'use strict';

            const K = new Uint32Array([
                0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5,
                0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174,
                0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,
                0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967,
                0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,
                0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,
                0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,
                0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2
            ]);

            const INITIAL_HASH = new Uint32Array([
                0x6a09e667, 0xbb67ae85, 0x3c6ef372, 0xa54ff53a,
                0x510e527f, 0x9b05688c, 0x1f83d9ab, 0x5be0cd19
            ]);

            function rightRotate(value, amount) {
                return (value >>> amount) | (value << (32 - amount));
            }

            function utf8ToBytes(str) {
                if (typeof TextEncoder !== 'undefined') {
                    return new TextEncoder().encode(str);
                }
                const bytes = [];
                for (let i = 0; i < str.length; i++) {
                    let codePoint = str.charCodeAt(i);
                    if (codePoint < 0x80) {
                        bytes.push(codePoint);
                    } else if (codePoint < 0x800) {
                        bytes.push(0xc0 | (codePoint >> 6));
                        bytes.push(0x80 | (codePoint & 0x3f));
                    } else if (codePoint >= 0xd800 && codePoint <= 0xdbff) {
                        i++;
                        const next = str.charCodeAt(i);
                        codePoint = ((codePoint - 0xd800) << 10) + (next - 0xdc00) + 0x10000;
                        bytes.push(0xf0 | (codePoint >> 18));
                        bytes.push(0x80 | ((codePoint >> 12) & 0x3f));
                        bytes.push(0x80 | ((codePoint >> 6) & 0x3f));
                        bytes.push(0x80 | (codePoint & 0x3f));
                    } else {
                        bytes.push(0xe0 | (codePoint >> 12));
                        bytes.push(0x80 | ((codePoint >> 6) & 0x3f));
                        bytes.push(0x80 | (codePoint & 0x3f));
                    }
                }
                return new Uint8Array(bytes);
            }

            function normalizeInput(message) {
                if (message instanceof Uint8Array) {
                    return message;
                }
                if (typeof message === 'string') {
                    return utf8ToBytes(message);
                }
                if (message instanceof ArrayBuffer) {
                    return new Uint8Array(message);
                }
                if (ArrayBuffer.isView(message)) {
                    return new Uint8Array(message.buffer, message.byteOffset, message.byteLength);
                }
                throw new TypeError('sha256: unsupported message type');
            }

            function sha256DigestBytes(message) {
                const bytes = normalizeInput(message);
                const length = bytes.length;
                const bitLength = length * 8;
                const paddedLength = (length + 9 + 63) & ~63;
                const padded = new Uint8Array(paddedLength);
                padded.set(bytes);
                padded[length] = 0x80;
                const view = new DataView(padded.buffer);
                view.setUint32(paddedLength - 8, Math.floor(bitLength / 0x100000000));
                view.setUint32(paddedLength - 4, bitLength >>> 0);

                const w = new Uint32Array(64);
                let h0 = INITIAL_HASH[0];
                let h1 = INITIAL_HASH[1];
                let h2 = INITIAL_HASH[2];
                let h3 = INITIAL_HASH[3];
                let h4 = INITIAL_HASH[4];
                let h5 = INITIAL_HASH[5];
                let h6 = INITIAL_HASH[6];
                let h7 = INITIAL_HASH[7];

                for (let offset = 0; offset < paddedLength; offset += 64) {
                    for (let i = 0; i < 16; i++) {
                        w[i] = view.getUint32(offset + (i << 2));
                    }
                    for (let i = 16; i < 64; i++) {
                        const s0 = (rightRotate(w[i - 15], 7) ^ rightRotate(w[i - 15], 18) ^ (w[i - 15] >>> 3)) >>> 0;
                        const s1 = (rightRotate(w[i - 2], 17) ^ rightRotate(w[i - 2], 19) ^ (w[i - 2] >>> 10)) >>> 0;
                        w[i] = (((((w[i - 16] + s0) >>> 0) + w[i - 7]) >>> 0) + s1) >>> 0;
                    }

                    let a = h0;
                    let b = h1;
                    let c = h2;
                    let d = h3;
                    let e = h4;
                    let f = h5;
                    let g = h6;
                    let h = h7;

                    for (let i = 0; i < 64; i++) {
                        const S1 = (rightRotate(e, 6) ^ rightRotate(e, 11) ^ rightRotate(e, 25)) >>> 0;
                        const ch = ((e & f) ^ (~e & g)) >>> 0;
                        const temp1 = ((((((h + S1) >>> 0) + ch) >>> 0) + K[i]) >>> 0) + w[i];
                        const S0 = (rightRotate(a, 2) ^ rightRotate(a, 13) ^ rightRotate(a, 22)) >>> 0;
                        const maj = ((a & b) ^ (a & c) ^ (b & c)) >>> 0;
                        const temp2 = (S0 + maj) >>> 0;

                        h = g;
                        g = f;
                        f = e;
                        e = (d + temp1) >>> 0;
                        d = c;
                        c = b;
                        b = a;
                        a = (temp1 + temp2) >>> 0;
                    }

                    h0 = (h0 + a) >>> 0;
                    h1 = (h1 + b) >>> 0;
                    h2 = (h2 + c) >>> 0;
                    h3 = (h3 + d) >>> 0;
                    h4 = (h4 + e) >>> 0;
                    h5 = (h5 + f) >>> 0;
                    h6 = (h6 + g) >>> 0;
                    h7 = (h7 + h) >>> 0;
                }

                const digest = new Uint8Array(32);
                const digestView = new DataView(digest.buffer);
                digestView.setUint32(0, h0);
                digestView.setUint32(4, h1);
                digestView.setUint32(8, h2);
                digestView.setUint32(12, h3);
                digestView.setUint32(16, h4);
                digestView.setUint32(20, h5);
                digestView.setUint32(24, h6);
                digestView.setUint32(28, h7);
                return digest;
            }

            function toHex(bytes) {
                const HEX = '0123456789abcdef';
                let out = '';
                for (let i = 0; i < bytes.length; i++) {
                    out += HEX[bytes[i] >>> 4] + HEX[bytes[i] & 0x0f];
                }
                return out;
            }

            function sha256(message) {
                return toHex(sha256DigestBytes(message));
            }

            sha256.array = function (message) {
                return Array.from(sha256DigestBytes(message));
            };

            sha256.digest = function (message) {
                return sha256DigestBytes(message);
            };

            sha256.arrayBuffer = function (message) {
                return sha256DigestBytes(message).buffer;
            };

            if (typeof module !== 'undefined' && module.exports) {
                module.exports = sha256;
            } else {
                root.sha256 = sha256;
            }
        })(typeof self !== 'undefined' ? self : globalThis);
    </script>

    <!-- ==========================================================================
    UI BEHAVIOR SCRIPT
    - This script handles all UI interactions, dynamic content, and navigation.
    - It contains NO core cryptographic logic.
    ========================================================================== -->
    <script>
        // ==========================================================================
        //
        //                                  UI LOGIC
        //
        // ==========================================================================

        // ==========================================================================
        // SECTION 1: UI - APPLICATION STATE & CACHE
        // ==========================================================================
        
        /** Custom error for checksum failures to pass row info to UI */
        class ChecksumError extends Error {
            constructor(message, row) {
                super(message);
                this.name = 'ChecksumError';
                this.row = row; // row is 0-indexed
            }
        }
        
        let createFlowWordCache = Array(24).fill('');
        let createWordCount = 24;

        let recoverFlowCache = [];
        const MAX_SHARES = 5;
        for (let i = 0; i < MAX_SHARES; i++) {
            recoverFlowCache.push({ shareNumber: '', words: Array(32).fill('') });
        }
        let recoverWordCount = 24;

        let activeSuggestionIndex = -1;
        let allowMouseHover = false;
        let currentAutocompleteInput = null;

        // ==========================================================================
        // SECTION 2: UI - DOM ELEMENT REFERENCES
        // ==========================================================================
        
        const pages = {
            landing: document.getElementById('pageLanding'),
            home: document.getElementById('pageHome'),
            create1: document.getElementById('pageCreate1'),
            create2: document.getElementById('pageCreate2'),
            recover1: document.getElementById('pageRecover1'),
            recover2: document.getElementById('pageRecover2'),
        };

        const disclaimerCheckbox = document.getElementById('disclaimer-checkbox');
        const btnContinueToHome = document.getElementById('btn-continue-to-home');
        const flowSubheader = document.getElementById('flow-subheader');

        const btnGoToCreate = document.getElementById('btn-go-to-create');
        const btnGoToRecover = document.getElementById('btn-go-to-recover');
        const btnsBackHome = document.querySelectorAll('.btn-back-home');
        const btnGenerateShares = document.getElementById('btn-generate-shares');
        const btnBackToCreate1 = document.getElementById('btn-back-to-create1');
        const btnStartOverCreate = document.getElementById('btn-start-over-create');
        const btnRecoverWallet = document.getElementById('btn-recover-wallet');
        const btnStartOverRecover = document.getElementById('btn-start-over-recover');
        const btnBackToRecover1 = document.getElementById('btn-back-to-recover1');

        const schemeRadios = document.querySelectorAll('input[name="scheme"]');
        const schemeExplanation = document.getElementById('scheme-explanation');
        const btn12Words = document.getElementById('btn-12-words');
        const btn24Words = document.getElementById('btn-24-words');
        const seedWordInputsContainer = document.getElementById('seed-word-inputs');

        const recoverKRadios = document.querySelectorAll('input[name="recover-k"]');
        const recoverSharesContainer = document.getElementById('recover-shares-container');
        const recoverBtn12Words = document.getElementById('recover-btn-12-words');
        const recoverBtn24Words = document.getElementById('recover-btn-24-words');
        
        const modal = document.getElementById('custom-modal');
        const modalConfirmBtn = document.getElementById('modal-confirm');
        const modalCancelBtn = document.getElementById('modal-cancel');
        const modalTitle = document.getElementById('modal-title');
            const modalText = document.getElementById('modal-text');
        
        const connectionStatusEl = document.getElementById('connection-status');
        const autocompleteContainer = document.getElementById('autocomplete-suggestions');

        // ==========================================================================
        // SECTION 3: UI - PAGE NAVIGATION
        // ==========================================================================
        
        /**
         * Hides all pages and shows the one specified by the key.
         * Also manages the visibility and content of the flow sub-header.
         * @param {string} pageKey - The key corresponding to the page in the `pages` object.
         * @param {string} [subheaderText=''] - Optional text for the flow sub-header.
         */
        function showPage(pageKey, subheaderText = '') {
            Object.values(pages).forEach(page => page.style.display = 'none');
            pages[pageKey].style.display = 'block';

            if (subheaderText) {
                flowSubheader.textContent = subheaderText;
                flowSubheader.style.display = 'block';
            } else {
                flowSubheader.style.display = 'none';
            }

            window.scrollTo(0, 0); // Scroll to top on page change
        }

        btnContinueToHome.addEventListener('click', () => showPage('home'));
        btnGoToCreate.addEventListener('click', () => showPage('create1', 'Create Shares'));
        btnGoToRecover.addEventListener('click', () => showPage('recover1', 'Recover Wallet'));
        btnsBackHome.forEach(btn => btn.addEventListener('click', () => showPage('home')));
        
        btnGenerateShares.addEventListener('click', async () => {
            try {
                // 1. Gather all inputs from the form
                const identifier = document.getElementById('wallet-identifier').value || 'Default Wallet';
                const date = document.getElementById('creation-date').value;
                const scheme = document.querySelector('input[name="scheme"]:checked').value;
                const [k, n] = scheme.split('of').map(Number);

                const words = [];
                for (let i = 1; i <= createWordCount; i++) {
                    const input = document.getElementById(`word-${i}`);
                    if (!input || !input.value) {
                        throw new Error(`Word #${i} is missing.`);
                    }
                    words.push(input.value.trim().toLowerCase());
                }
                const mnemonic = words.join(' ');

                // 2. Call the core logic function
                // Note: BIP39_WORDLIST must be globally available for this to work.
                
                // --- TEMPORARY DEBUG START ---
                // To revert, uncomment the ORIGINAL lines and remove the TEMPORARY DEBUG lines.
                // const { shares } = await splitBip39(mnemonic, k, n, BIP39_WORDLIST); // ORIGINAL
                const { shares, debugCoefficients } = await splitBip39(mnemonic, k, n, BIP39_WORDLIST); // TEMPORARY DEBUG
                
                // 3. Populate the next page and display it
                // displayShares(shares, { identifier, date, scheme, wordCount: createWordCount }, debugCoefficients); // ORIGINAL
                displayShares(shares, { identifier, date, scheme, wordCount: createWordCount }, debugCoefficients); // TEMPORARY DEBUG
                // --- TEMPORARY DEBUG END ---

                showPage('create2', 'Create Shares');

            } catch (error) {
                await showErrorModal('Generation Failed', error.message);
            }
        });
        
        btnBackToCreate1.addEventListener('click', () => showPage('create1', 'Create Shares'));
        btnBackToRecover1.addEventListener('click', () => showPage('recover1', 'Recover Wallet'));

        btnRecoverWallet.addEventListener('click', async () => {
            clearAllRecoveryHighlights(); // Clear previous errors first
            try {
                // 1. Gather all inputs from the recovery form
                const k = parseInt(document.querySelector('input[name="recover-k"]:checked').value, 10);
                
                const shares = [];
                const shareContainers = document.querySelectorAll('#recover-shares-container .share-input-container');

                if (shareContainers.length !== k) {
                    throw new Error("The number of input forms does not match the selected threshold (K).");
                }

                for (let i = 0; i < k; i++) {
                    const container = shareContainers[i];
                    const shareNumberInput = container.querySelector(`[id^="recover-x-"]`);
                    const masterShareInput = container.querySelector(`[id^="recover-master-"]`);
                    const shareNumber = parseInt(shareNumberInput.value.trim(), 10);
                    
                    // Parse "word - number" format for master share
                    const masterShare = resolveShareValue(masterShareInput.value);

                    if (isNaN(shareNumber)) {
                        throw new Error(`Share #${i + 1} is missing a share number (X).`);
                    }
                    if (isNaN(masterShare)) {
                        throw new Error(`Share #${i + 1} is missing a master verification share value.`);
                    }

                    const wordInputs = container.querySelectorAll('.seed-word-row input');
                    const values = Array.from(wordInputs).map(input => {
                        // The input can be a word "abandon" or a word-number pair "abandon - 0000" or just a number "0"
                        const val = resolveShareValue(input.value);
                        if (isNaN(val)) throw new Error(`Invalid or missing numeric value in Share #${shareNumber}. All share values (Y) must be numbers, or word-number pairs.`);
                        return val;
                    });
                    
                    const wordsPerChecksum = 3;
                    const numRows = recoverWordCount / wordsPerChecksum;
                    const share = {
                        shareNumber: shareNumber,
                        wordShares: [],
                        checksumShares: [],
                        masterVerificationShare: masterShare
                    };

                    let valueIndex = 0;
                    for(let r = 0; r < numRows; r++) {
                        for(let w = 0; w < wordsPerChecksum; w++) {
                            share.wordShares.push(values[valueIndex++]);
                        }
                        share.checksumShares.push(values[valueIndex++]);
                    }

                    shares.push(share);
                }

                // 2. Call the core recovery function
                const recoveredMnemonic = await recoverBip39(shares, recoverWordCount, BIP39_WORDLIST);

                // 3. Display the result on the next page
                displayRecoveredMnemonic(recoveredMnemonic);
                showPage('recover2', 'Recover Wallet');

            } catch (error) {
                if (error instanceof ChecksumError) {
                    const invalidRows = findInvalidShareRows(shares, error.row);
                    const messageDetails = invalidRows.length
                        ? `Share #${invalidRows[0].shareNumber}, row #${invalidRows[0].rowIndex + 1}`
                        : `Row #${(error.row ?? 0) + 1}`;
                    await showErrorModal('Checksum Error', `Validate the entry. ${messageDetails} has a calculation error.`);
                    if (invalidRows.length) {
                        invalidRows.forEach(({ shareNumber, rowIndex }) => highlightErrorRow(rowIndex, shareNumber));
                    } else {
                        highlightErrorRow(error.row);
                    }
                } else {
                    await showErrorModal('Recovery Failed', error.message);
                }
            }
        });
        /**
         * Returns any share rows whose Y values do not match their checksum entry.
         * Optionally restricts the inspection to a specific row index.
         * @param {Array<Object>} shares
         * @param {number|null} targetRowIndex
         * @returns {Array<{shareNumber: number, rowIndex: number}>}
         */
        function findInvalidShareRows(shares, targetRowIndex = null) {
            if (!Array.isArray(shares)) return [];
            const invalid = [];
            shares.forEach(share => {
                if (!share || !Array.isArray(share.wordShares) || !Array.isArray(share.checksumShares)) return;
                const rowCount = share.checksumShares.length;
                for (let rowIndex = 0; rowIndex < rowCount; rowIndex++) {
                    if (targetRowIndex !== null && rowIndex !== targetRowIndex) continue;
                    const base = rowIndex * WORDS_PER_ROW;
                    const computedChecksum = modAdd(
                        modAdd(share.wordShares[base], share.wordShares[base + 1]),
                        share.wordShares[base + 2]
                    );
                    if (computedChecksum !== share.checksumShares[rowIndex]) {
                        invalid.push({ shareNumber: share.shareNumber, rowIndex });
                    }
                }
            });
            return invalid;
        }


        disclaimerCheckbox.addEventListener('change', () => {
            btnContinueToHome.disabled = !disclaimerCheckbox.checked;
        });
        
        // ==========================================================================
        // SECTION 4: UI - DYNAMIC CONTENT (CREATE & RECOVER FLOWS)
        // ==========================================================================
        
        const explanations = {
            '2of3': {
                title: '2-of-3 Scheme (Default)',
                details: '<p>You will create <strong>3 shares</strong> in total. To recover the wallet, you will need any <strong>2 of them</strong>. This is a common and balanced setup for personal backup.</p>'
            },
            '2of4': {
                title: '2-of-4 Scheme',
                details: '<p>You will create <strong>4 shares</strong> in total. To recover the wallet, you will need any <strong>2 of them</strong>. This offers more redundancy, allowing for the loss of up to two shares.</p>'
            },
            '3of5': {
                title: '3-of-5 Scheme (Sovereign)',
                details: '<p>You will create <strong>5 shares</strong> in total. To recover the wallet, you will need any <strong>3 of them</strong>. This is highly secure and resilient, ideal for group custody or high-value assets.</p>'
            }
        };

        /**
         * Updates the scheme explanation box based on the selected radio button.
         */
        function updateSchemeDescription() {
            const selectedValue = document.querySelector('input[name="scheme"]:checked').value;
            const content = explanations[selectedValue];
            schemeExplanation.innerHTML = `<h4>${content.title}</h4>${content.details}`;
        }

        /**
         * Generates the seed word input fields for the Create page, using the cache.
         */
        function updateSeedWordInputs() {
            // 1. Take a "snapshot" of the currently visible inputs and save to the cache.
            const existingInputs = seedWordInputsContainer.querySelectorAll('input');
            existingInputs.forEach((input, index) => {
                if (index < createFlowWordCache.length) {
                    createFlowWordCache[index] = input.value;
                }
            });

            // 2. Clear and regenerate inputs.
            seedWordInputsContainer.innerHTML = ''; 
            for (let i = 1; i <= createWordCount; i++) {
                const row = document.createElement('div');
                row.className = 'seed-word-row';
                const label = document.createElement('label');
                label.htmlFor = `word-${i}`;
                label.textContent = `${i}.`;
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `word-${i}`;
                input.className = 'mono';
                input.value = createFlowWordCache[i - 1] || ''; // 3. Restore from cache.
                attachAutocompleteListeners(input);
                row.appendChild(label);
                row.appendChild(input);
                seedWordInputsContainer.appendChild(row);
            }
        }
        
        schemeRadios.forEach(radio => radio.addEventListener('change', updateSchemeDescription));
        
        /**
         * Generates a complete HTML block for a single share's input fields from the cache.
         * @param {number} shareIndex - The index of the share to generate (1-based).
         * @returns {HTMLElement} The fully constructed div element for the share input.
         */
        function generateSingleRecoverShareInput(shareIndex) {
            const cacheIndex = shareIndex - 1;
            const shareCache = recoverFlowCache[cacheIndex];

            const container = document.createElement('div');
            container.className = 'share-input-container';

            const mainHeader = document.createElement('h3');
            mainHeader.textContent = `Share Input #${shareIndex}`;
            container.appendChild(mainHeader);

            const twoColGrid = document.createElement('div');
            twoColGrid.style.display = 'grid';
            twoColGrid.style.gridTemplateColumns = '1fr 1fr';
            twoColGrid.style.gap = '20px';

            const shareNumberGroup = document.createElement('div');
            shareNumberGroup.className = 'form-group';
            const labelX = document.createElement('label');
            labelX.htmlFor = `recover-x-${shareIndex}`;
            labelX.textContent = `Share Number (X)`;
            const inputX = document.createElement('input');
            inputX.type = 'text';
            inputX.id = `recover-x-${shareIndex}`;
            inputX.className = 'mono';
            inputX.placeholder = 'E.g., 3';
            inputX.value = shareCache.shareNumber;
            shareNumberGroup.appendChild(labelX);
            shareNumberGroup.appendChild(inputX);
            twoColGrid.appendChild(shareNumberGroup);

            const masterShareGroup = document.createElement('div');
            masterShareGroup.className = 'form-group';
            const labelMaster = document.createElement('label');
            labelMaster.htmlFor = `recover-master-${shareIndex}`;
            labelMaster.textContent = `Master Verification Share`;
            const inputMaster = document.createElement('input');
            inputMaster.type = 'text';
            inputMaster.id = `recover-master-${shareIndex}`;
            inputMaster.className = 'mono';
            inputMaster.placeholder = 'E.g., abandon - 0001';
            inputMaster.value = shareCache.masterVerificationShare || '';
            attachAutocompleteListeners(inputMaster);
            masterShareGroup.appendChild(labelMaster);
            inputMaster.dataset.allowNumeric = 'true';
            masterShareGroup.appendChild(inputMaster);
            twoColGrid.appendChild(masterShareGroup);
            
            container.appendChild(twoColGrid);

            const seedGrid = document.createElement('div');
            seedGrid.style.display = 'grid';
            seedGrid.style.gridTemplateColumns = 'repeat(4, 1fr)';
            seedGrid.style.gap = '15px';

            const totalWords = recoverWordCount;
            const wordsPerChecksum = 3;
            const numChecksums = totalWords / wordsPerChecksum;

            let wordCounter = 0;
            for (let i = 1; i <= numChecksums; i++) {
                for (let j = 0; j < wordsPerChecksum; j++) {
                    const row = document.createElement('div');
                    row.className = 'seed-word-row';
                    const label = document.createElement('label');
                    const wordNumber = (i - 1) * wordsPerChecksum + j + 1;
                    label.textContent = `${wordNumber}.`;
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'mono';
                    input.value = shareCache.words[wordCounter] || '';
                    input.dataset.allowNumeric = 'true';
                    attachAutocompleteListeners(input);
                    row.appendChild(label);
                    row.appendChild(input);
                    seedGrid.appendChild(row);
                    wordCounter++;
                }
                const row = document.createElement('div');
                row.className = 'seed-word-row';
                const label = document.createElement('label');
                label.textContent = `C${i}.`;
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'mono';
                input.value = shareCache.words[wordCounter] || '';
                input.dataset.allowNumeric = 'true';
                attachAutocompleteListeners(input);
                row.appendChild(label);
                row.appendChild(input);
                seedGrid.appendChild(row);
                wordCounter++;
            }

            container.appendChild(seedGrid);
            return container;
        }

        /**
         * Clears and regenerates all share input blocks based on the selected K value.
         */
        function updateRecoverSharesInputs() {
            // 1. Take a "snapshot" of the current UI state and save it to the cache.
            const existingContainers = recoverSharesContainer.querySelectorAll('.share-input-container');
            existingContainers.forEach((container) => {
                const shareNumberInput = container.querySelector('[id^="recover-x-"]');
                const masterShareInput = container.querySelector('[id^="recover-master-"]');
                if (!shareNumberInput) return;
                
                const shareIndex = parseInt(shareNumberInput.id.split('-').pop(), 10) - 1;
                const cacheEntry = recoverFlowCache[shareIndex];
                
                if (cacheEntry) {
                    cacheEntry.shareNumber = shareNumberInput.value;
                    cacheEntry.masterVerificationShare = masterShareInput.value;
                    const wordInputs = container.querySelectorAll('.seed-word-row input');
                    wordInputs.forEach((input, wordIndex) => {
                        if (wordIndex < cacheEntry.words.length) {
                            cacheEntry.words[wordIndex] = input.value;
                        }
                    });
                }
            });

            // 2. Clear and regenerate the UI.
            recoverSharesContainer.innerHTML = '';
            const kValue = document.querySelector('input[name="recover-k"]:checked').value;
            const numShares = parseInt(kValue, 10);
            for (let i = 1; i <= numShares; i++) {
                const shareInputBlock = generateSingleRecoverShareInput(i);
                recoverSharesContainer.appendChild(shareInputBlock);
            }
        }

        recoverKRadios.forEach(radio => radio.addEventListener('change', updateRecoverSharesInputs));
        
        // ==========================================================================
        // SECTION 5: UI - AUTOCOMPLETE & VALIDATION
        // ==========================================================================

        /**
         * Attaches all necessary event listeners for autocomplete and validation to an input field.
         * @param {HTMLInputElement} input - The input element.
         */
        function attachAutocompleteListeners(input) {
            input.addEventListener('input', () => {
                currentAutocompleteInput = input;
                showAutocomplete(input);
            });
            input.addEventListener('keydown', handleAutocompleteKeydown);
            attachValidationListener(input); // Also attach the blur validation
        }

        /**
         * Attaches only the blur validation listener to an input field (e.g., for checksums).
         * @param {HTMLInputElement} input - The input element.
         */
        function attachValidationListener(input) {
             input.addEventListener('blur', () => {
                setTimeout(() => {
                    if (!autocompleteContainer.contains(document.activeElement)) {
                        hideAutocomplete();
                        validateInput(input);
                    }
                }, 150);
            });
        }

        /**
         * Displays and positions the autocomplete suggestion box, preferring side placement
         * and intelligently adjusting vertically to stay within the viewport.
         * @param {HTMLInputElement} input - The input element to position against.
         */
        function showAutocomplete(input) {
            const value = input.value.toLowerCase().trim();
            if (!value) {
                hideAutocomplete();
                return;
            }

            const suggestions = BIP39_WORDLIST.filter(word => word.startsWith(value));
            if (suggestions.length === 0) {
                hideAutocomplete();
                return;
            }

            autocompleteContainer.innerHTML = '';
            autocompleteContainer.addEventListener('mousemove', () => {
                allowMouseHover = true;
            }, { once: true });

            suggestions.forEach((word, index) => {
                const item = document.createElement('div');
                item.className = 'autocomplete-suggestion';
                item.textContent = word;
                item.addEventListener('click', () => {
                    input.value = word;
                    hideAutocomplete();
                    validateInput(input);
                });
                item.addEventListener('mouseenter', () => {
                    if (allowMouseHover) {
                        activeSuggestionIndex = index;
                        const suggestionElements = autocompleteContainer.querySelectorAll('.autocomplete-suggestion');
                        updateActiveSuggestion(suggestionElements);
                    }
                });
                autocompleteContainer.appendChild(item);
            });
            
            const suggestionElements = autocompleteContainer.querySelectorAll('.autocomplete-suggestion');
            if (suggestionElements.length === 1) {
                activeSuggestionIndex = 0;
                updateActiveSuggestion(suggestionElements);
            } else {
                activeSuggestionIndex = -1;
            }

            const GAP = 8;
            const VIEWPORT_PADDING = 10;
            
            autocompleteContainer.style.visibility = 'hidden';
            autocompleteContainer.style.display = 'block';
            const suggestionsHeight = autocompleteContainer.offsetHeight;
            const suggestionsWidth = autocompleteContainer.offsetWidth;

            const rect = input.getBoundingClientRect();
            let top, left;

            const canFitRight = rect.right + GAP + suggestionsWidth < window.innerWidth - VIEWPORT_PADDING;
            const canFitLeft = rect.left - GAP - suggestionsWidth > VIEWPORT_PADDING;

            let adjustedTop = rect.top;
            if (adjustedTop + suggestionsHeight > window.innerHeight - VIEWPORT_PADDING) {
                adjustedTop = window.innerHeight - suggestionsHeight - VIEWPORT_PADDING;
            }
            adjustedTop = Math.max(VIEWPORT_PADDING, adjustedTop);

            if (canFitRight) {
                left = rect.right + GAP;
                top = adjustedTop;
            } else if (canFitLeft) {
                left = rect.left - suggestionsWidth - GAP;
                top = adjustedTop;
            } else {
                const spaceBelow = window.innerHeight - rect.bottom;
                if (spaceBelow > suggestionsHeight || spaceBelow > rect.top) {
                    top = rect.bottom;
                } else {
                    top = rect.top - suggestionsHeight;
                }
                left = rect.left;
            }

            autocompleteContainer.style.top = `${top + window.scrollY}px`;
            autocompleteContainer.style.left = `${left + window.scrollX}px`;
            autocompleteContainer.style.width = suggestionsWidth ? `${suggestionsWidth}px` : 'auto';
            autocompleteContainer.style.visibility = 'visible';
        }

        /** Hides the autocomplete suggestion box and resets its state. */
        function hideAutocomplete() {
            autocompleteContainer.style.display = 'none';
            currentAutocompleteInput = null;
            allowMouseHover = false;
        }

        /**
         * Handles keyboard navigation (arrows, Enter, Escape, Tab) for the autocomplete box.
         * @param {KeyboardEvent} e - The keydown event.
         */
        function handleAutocompleteKeydown(e) {
            const suggestions = autocompleteContainer.querySelectorAll('.autocomplete-suggestion');
            if (suggestions.length === 0 || autocompleteContainer.style.display === 'none') return;

            if (e.key === 'ArrowDown') {
                e.preventDefault();
                activeSuggestionIndex++;
                if (activeSuggestionIndex >= suggestions.length) activeSuggestionIndex = 0;
                updateActiveSuggestion(suggestions);
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                activeSuggestionIndex--;
                if (activeSuggestionIndex < 0) activeSuggestionIndex = suggestions.length - 1;
                updateActiveSuggestion(suggestions);
            } else if (e.key === 'Enter' || e.key === 'Tab') {
                if (activeSuggestionIndex > -1) {
                    e.preventDefault();
                    suggestions[activeSuggestionIndex].click();
                }
            } else if (e.key === 'Escape') {
                e.preventDefault();
                hideAutocomplete();
            }
        }
        
        /**
         * Updates the visual state of the active suggestion for keyboard navigation.
         * @param {NodeListOf<Element>} suggestions - The list of suggestion elements.
         */
        function updateActiveSuggestion(suggestions) {
            suggestions.forEach((item, index) => {
                item.classList.toggle('autocomplete-active', index === activeSuggestionIndex);
            });
        }
        
        /**
         * Attempts to extract the trailing numeric portion from an input value.
         * Supports free-form text such as "word - 0001" or "Master Share: 1234".
         * @param {string} value
         * @returns {number} Parsed integer or NaN if none found.
         */
        function extractShareValue(value) {
            if (!value) return NaN;
            const match = value.trim().match(/(\d+)\s*$/);
            return match ? parseInt(match[1], 10) : NaN;
        }

        /**
         * Resolves a share input into a numeric value.
         * Accepts trailing-number formats or standalone BIP39 words.
         * @param {string} value
         * @returns {number} Parsed integer or NaN if it cannot be resolved.
         */
        function resolveShareValue(value) {
            if (!value) return NaN;
            const trimmed = value.trim();
            const numeric = extractShareValue(trimmed);
            if (Number.isInteger(numeric) && numeric >= 0 && numeric < FIELD_PRIME) {
                return numeric;
            }
            const normalizedWord = trimmed.toLowerCase();
            const wordIndex = BIP39_WORDLIST.indexOf(normalizedWord);
            if (wordIndex !== -1) {
                return wordIndex;
            }
            return NaN;
        }

        /**
         * Validates an input's value on blur.
         * A valid input can be a BIP39 word, a number in the field, or a "word - number" pair.
         * @param {HTMLInputElement} input - The input element to validate.
         */
        function validateInput(input) {
            const value = input.value.trim();
            if (!value) {
                input.classList.remove('invalid');
                return; // Still valid if empty
            }

            // A valid input can be:
            // 1. A word from the BIP39 wordlist.
            // 2. (Optionally) A string with a numeric value in our field.
            const normalizedWord = value.toLowerCase();
            const isWordInList = BIP39_WORDLIST.includes(normalizedWord);
            const allowNumeric = input.dataset.allowNumeric === 'true';
            let isValid = isWordInList;

            if (allowNumeric) {
                const resolvedValue = resolveShareValue(value);
                const isParsableToValidNumber = Number.isInteger(resolvedValue) && resolvedValue >= 0 && resolvedValue < FIELD_PRIME;
                isValid = isValid || isParsableToValidNumber;
            }
            
            input.classList.toggle('invalid', !isValid);
        }

        /**
         * Clears any prior checksum-row highlights applied during recovery attempts.
         * Only inputs explicitly marked as row highlights are reset, so user validation hints remain intact.
         */
        function clearAllRecoveryHighlights() {
            const highlighted = recoverSharesContainer.querySelectorAll('[data-row-highlight="true"]');
            highlighted.forEach(input => {
                input.classList.remove('invalid');
                input.removeAttribute('data-row-highlight');
            });
        }

        /**
         * Marks every input involved in the specified checksum row across all share forms as invalid.
         * @param {number} rowIndex - Zero-based index of the row reported by the checksum error.
         */
        function highlightErrorRow(rowIndex, targetShareNumber = null) {
            if (typeof rowIndex !== 'number' || rowIndex < 0) return;
            const rowsPerShare = WORDS_PER_ROW + 1; // 3 words + 1 checksum input
            const inputsPerShare = rowsPerShare * (recoverWordCount / WORDS_PER_ROW);
            const shareContainers = recoverSharesContainer.querySelectorAll('.share-input-container');

            shareContainers.forEach(container => {
                if (targetShareNumber) {
                    const shareNumberInput = container.querySelector('[id^="recover-x-"]');
                    const containerShareNumber = parseInt(shareNumberInput?.value, 10);
                    if (containerShareNumber !== targetShareNumber) {
                        return;
                    }
                }

                const inputs = Array.from(container.querySelectorAll('.seed-word-row input'));
                if (inputs.length !== inputsPerShare) return;

                const start = rowIndex * rowsPerShare;
                const end = start + rowsPerShare;
                if (start < 0 || end > inputs.length) return;

                for (let i = start; i < end; i++) {
                    const input = inputs[i];
                    input.classList.add('invalid');
                    input.setAttribute('data-row-highlight', 'true');
                }
            });
        }
        
        // ==========================================================================
        // SECTION 6: UI - MODALS & DIALOGS
        // ==========================================================================

        let modalResolve = null;

        /**
         * Displays a custom confirmation modal and returns a promise that resolves on user action.
         * @param {string} title - The title to display in the modal.
         * @param {string} text - The body text to display in the modal.
         * @returns {Promise<boolean>} A promise that resolves to `true` if confirmed, `false` otherwise.
         */
        function showConfirmationModal(title, text) {
            modalTitle.textContent = title;
            modalText.textContent = text;
            modal.style.display = 'flex';
            return new Promise((resolve) => {
                modalResolve = resolve;
            });
        }

        /**
         * A wrapper for `showConfirmationModal` tailored for displaying error messages.
         * @param {string} title - The title of the error.
         * @param {string} text - The detailed error message.
         * @returns {Promise<void>} A promise that resolves when the user dismisses the modal.
         */
        function showErrorModal(title, text) {
            modalTitle.textContent = title;
            modalText.textContent = text;
            modalConfirmBtn.textContent = 'OK';
            modalCancelBtn.style.display = 'none';
            modal.style.display = 'flex';

            return new Promise((resolve) => {
                modalResolve = resolve; // This will be resolved as `true` by the existing listener
            });
        }

        modalConfirmBtn.addEventListener('click', () => {
            if (modalResolve) modalResolve(true);
            modal.style.display = 'none';
            // Reset modal to its default confirmation state after use
            modalConfirmBtn.textContent = 'Confirm';
            modalCancelBtn.style.display = 'inline-block';
        });

        modalCancelBtn.addEventListener('click', () => {
            if (modalResolve) modalResolve(false);
            modal.style.display = 'none';
        });

        /**
         * Dynamically generates and displays the share cards on Page 2.
         * @param {Array<Object>} shares - The array of generated share data.
         * @param {Object} metadata - The wallet metadata from the form.
         */
        // --- TEMPORARY DEBUG START ---
        // To revert, comment out the TEMPORARY DEBUG line and uncomment the ORIGINAL line.
        // function displayShares(shares, metadata) { // ORIGINAL
        function displayShares(shares, metadata, debugCoefficients) { // TEMPORARY DEBUG
        // --- TEMPORARY DEBUG END ---
            const outputContainer = document.getElementById('shares-output');
            const printContainer = document.getElementById('print-output');
            
            const [k, n] = metadata.scheme.split('of').map(Number);

            const manualRecoveryInstructions = `
                <div class="component-card" style="margin-top: 2rem; border-style: dashed; page-break-inside: avoid;">
                    <h4>Manual Recovery Instructions (Pencil & Paper)</h4>
                    <p style="font-size: 0.8rem; color: var(--text-muted); text-align: left;">
                        These instructions explain how to recover the original wallet phrase without a computer, using only the numbers from your share sheets. You will need at least <strong>${k} different share sheets</strong> from this set to proceed. All calculations are performed "modulo 2053", which means you divide by 2053 and take the remainder.
                    </p>
                    <ol style="font-size: 0.8rem; padding-left: 20px; text-align: left;">
                        <li style="margin-bottom: 0.5em;">
                            <strong>Find Lagrange Coefficients (Œ≥):</strong> For the specific set of Share Numbers you have (e.g., #1, #2), you need a corresponding set of "Lagrange Coefficients". These are non-secret numbers. You can find them in the Schiavinato Sharing whitepaper for common schemes or generate them with the official tool. You will have one coefficient for each share you are using.
                        </li>
                        <li style="margin-bottom: 0.5em;">
                            <strong>Recover One Number:</strong> To recover a single original number (e.g., for position #1), take the numeric value (Y) from that position on each of your ${k} share sheets. Multiply each Y value by its corresponding Lagrange Coefficient (Œ≥). Sum all the results. The remainder of this sum when divided by 2053 is the recovered secret number.
                            <br><em>Formula: (Y‚ÇÅ¬∑Œ≥‚ÇÅ + Y‚ÇÇ¬∑Œ≥‚ÇÇ + ...) mod 2053 = Secret</em>
                        </li>
                        <li style="margin-bottom: 0.5em;">
                            <strong>Recover and Verify Each Row:</strong> Repeat step 2 for all three word values and the checksum value in a single row. Then, verify your math: add your three recovered word numbers together (modulo 2053). The result MUST equal your recovered checksum number for that row. If it doesn't, you have made a calculation error in that row.
                        </li>
                        <li style="margin-bottom: 0.5em;">
                            <strong>Final Master Verification:</strong> After all rows are recovered and verified, use the same method from step 2 to recover the "Master Verification Number" from the share headers. Then, add all 24 of your recovered word numbers together (modulo 2053). The result MUST equal the recovered Master Verification Number. If it doesn't, an error exists in one or more rows.
                        </li>
                        <li style="margin-bottom: 0.5em;">
                            <strong>Convert to Words:</strong> Once all checks pass, use the standard BIP39 wordlist to look up the word for each of your 24 recovered numbers. The resulting sequence of 24 words is your wallet's original recovery phrase.
                        </li>
                    </ol>
                </div>
            `;

            let allSharesScreenHtml = '';
            let allSharesPrintHtml = '';

            shares.forEach(share => {
                const masterValue = share.masterVerificationShare;
                const masterWord = masterValue < 2048 ? BIP39_WORDLIST[masterValue] : String(masterValue);
                const masterShareDisplay = `${masterWord} - ${String(masterValue).padStart(4, '0')}`;

                let wordListHtml = '';
                let wordCounter = 0;
                for (let i = 0; i < (metadata.wordCount / 3); i++) {
                    for (let j = 0; j < 3; j++) {
                        const value = share.wordShares[wordCounter];
                        const word = value < 2048 ? BIP39_WORDLIST[value] : String(value);
                        const display = `${word} - ${String(value).padStart(4, '0')}`;
                        wordListHtml += `<div class="share-word-item"><label>${wordCounter + 1}.</label><code class="mono">${display}</code></div>`;
                        wordCounter++;
                    }
                    const checksumValue = share.checksumShares[i];
                    const checksumWord = checksumValue < 2048 ? BIP39_WORDLIST[checksumValue] : String(checksumValue);
                    const checksumDisplay = `${checksumWord} - ${String(checksumValue).padStart(4, '0')}`;
                    wordListHtml += `<div class="share-word-item"><label>C${i + 1}.</label><code class="mono">${checksumDisplay}</code></div>`;
                }

                const shareContentHtml = `
                    <h3>Share ${share.shareNumber} of ${n}</h3>
                    <hr>
                    <div class="share-metadata">
                        <p><strong>Wallet Identifier:</strong> ${metadata.identifier}</p>
                        <p><strong>Creation Date:</strong> ${metadata.date}</p>
                        <p><strong>Scheme:</strong> ${metadata.scheme}</p>
                        <p><strong>Share Number (X):</strong> ${share.shareNumber}</p>
                        <p><strong>Master Verification Share:</strong> <code class="mono">${masterShareDisplay}</code></p>
                    </div>
                    <h4 style="margin-top: 25px; margin-bottom: 10px; color: var(--text-muted); font-weight: 600;">Share Values (Y)</h4>
                    <div class="share-word-container">
                        <div class="share-word-list">${wordListHtml}</div>
                    </div>
                `;

                const printWarningHtml = `
                    <div style="text-align: center; padding: 5px; border: 1px solid var(--error-red); background: var(--alert-error-bg); border-radius: 8px; margin-bottom: 1rem;">
                        <strong style="color: var(--error-red);">This is 1 of ${n} shares. It CANNOT recover funds alone. Do NOT enter these words into a wallet.</strong>
                    </div>
                `;

                allSharesScreenHtml += `<div class="component-card share-card">${shareContentHtml}</div>`;
                allSharesPrintHtml += `<div class="component-card share-card">${printWarningHtml}${shareContentHtml}${manualRecoveryInstructions}</div>`;
            });

            outputContainer.innerHTML = allSharesScreenHtml;
            printContainer.innerHTML = allSharesPrintHtml;

            // --- TEMPORARY DEBUG START ---
            // To revert, simply delete this entire block.
            const existingDebugContainer = document.getElementById('debug-container'); // TEMPORARY DEBUG
            if (existingDebugContainer) { // TEMPORARY DEBUG
                existingDebugContainer.remove(); // TEMPORARY DEBUG
            } // TEMPORARY DEBUG
            if (debugCoefficients) { // TEMPORARY DEBUG
                const debugContainer = document.createElement('div'); // TEMPORARY DEBUG
                debugContainer.id = 'debug-container'; // TEMPORARY DEBUG
                debugContainer.className = 'component-card'; // TEMPORARY DEBUG
                debugContainer.style.marginTop = '2rem'; // TEMPORARY DEBUG
                debugContainer.style.border = '2px dashed var(--error-red)'; // TEMPORARY DEBUG
                
                // --- TEMPORARY DEBUG START ---
                // This block formats the debug output into a copyable textarea of raw numbers.
                let debugTextContent = ''; // TEMPORARY DEBUG

                // Words
                debugCoefficients.words.forEach(coeffs => { // TEMPORARY DEBUG
                    coeffs.forEach(c => { // TEMPORARY DEBUG
                        debugTextContent += `${c}\n`; // TEMPORARY DEBUG
                    }); // TEMPORARY DEBUG
                }); // TEMPORARY DEBUG

                // Checksums
                debugCoefficients.checksums.forEach(coeffs => { // TEMPORARY DEBUG
                    coeffs.forEach(c => { // TEMPORARY DEBUG
                        debugTextContent += `${c}\n`; // TEMPORARY DEBUG
                    }); // TEMPORARY DEBUG
                }); // TEMPORARY DEBUG

                // Master
                debugCoefficients.master.forEach(c => { // TEMPORARY DEBUG
                    debugTextContent += `${c}\n`; // TEMPORARY DEBUG
                }); // TEMPORARY DEBUG

                let debugHtml = '<h3 style="color: var(--error-red);">TEMPORARY DEBUG INFO: Polynomial Coefficients</h3>'; // TEMPORARY DEBUG
                debugHtml += '<p style="font-size: 0.8rem; color: var(--text-muted);">A raw list of the random coefficients used. You can copy from the text area below.</p>'; // TEMPORARY DEBUG
                debugHtml += `<textarea readonly class="mono" style="width: 100%; height: 250px; white-space: pre; resize: vertical; padding: 1em; border-radius: 6px; background: var(--input-bg); border: 1px solid var(--border-color); color: var(--input-text);">${debugTextContent.trim()}</textarea>`; // TEMPORARY DEBUG
                // --- TEMPORARY DEBUG END ---

                debugContainer.innerHTML = debugHtml; // TEMPORARY DEBUG
                outputContainer.insertAdjacentElement('afterend', debugContainer); // TEMPORARY DEBUG
            } // TEMPORARY DEBUG
            // --- TEMPORARY DEBUG END ---
        }

        /**
         * Dynamically generates and displays the recovered mnemonic on Page 4.
         * @param {string} mnemonic - The recovered BIP39 mnemonic string.
         */
        function displayRecoveredMnemonic(mnemonic) {
            const words = mnemonic.split(' ');
            const container = document.querySelector('#pageRecover2 .share-word-list');
            if (!container) return;

            container.innerHTML = ''; // Clear previous results

            words.forEach((word, index) => {
                const item = document.createElement('div');
                item.className = 'share-word-item';
                const label = document.createElement('label');
                label.textContent = `${index + 1}.`;
                const code = document.createElement('code');
                code.className = 'mono';
                code.textContent = word;
                item.appendChild(label);
                item.appendChild(code);
                container.appendChild(item);
            });

            // Adjust grid columns based on word count for better layout
            const columns = 3;
            container.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
        }

        // ==========================================================================
        // SECTION 7: UI - EVENT LISTENERS & INITIALIZATION
        // ==========================================================================
        
        /**
         * Sets up the event listeners and class toggling for a pair of 12/24 word buttons.
         * @param {HTMLButtonElement} btn12 - The 12-words button.
         * @param {HTMLButtonElement} btn24 - The 24-words button.
         * @param {function(number): void} wordCountCallback - A function to call with the new word count.
         * @param {function(): void} updateFn - The function to call to regenerate the inputs.
         */
        function setupWordToggle(btn12, btn24, wordCountCallback, updateFn) {
            btn12.addEventListener('click', () => {
                wordCountCallback(12);
                btn12.classList.add('btn-primary');
                btn12.classList.remove('btn-secondary');
                btn24.classList.add('btn-secondary');
                btn24.classList.remove('btn-primary');
                updateFn();
            });
            btn24.addEventListener('click', () => {
                wordCountCallback(24);
                btn24.classList.add('btn-primary');
                btn24.classList.remove('btn-secondary');
                btn12.classList.add('btn-secondary');
                btn12.classList.remove('btn-primary');
                updateFn();
            });
        }
        
        /**
         * Attaches a confirmation dialog to a "start over" button.
         * @param {HTMLButtonElement} button - The button to attach the listener to.
         * @param {string} title - The title for the confirmation modal.
         * @param {string} text - The descriptive text for the confirmation modal.
         */
        function setupStartOverButton(button, title, text) {
            button.addEventListener('click', async () => {
                const confirmed = await showConfirmationModal(title, text);
                if (confirmed) {
                    window.location.reload();
                }
            });
        }
        
        setupWordToggle(btn12Words, btn24Words, (count) => { createWordCount = count; }, updateSeedWordInputs);
        setupWordToggle(recoverBtn12Words, recoverBtn24Words, (count) => { recoverWordCount = count; }, updateRecoverSharesInputs);
        
        setupStartOverButton(
            btnStartOverCreate,
            'Are you sure?',
            'All entered data and generated shares will be lost forever. This action cannot be undone.'
        );
        setupStartOverButton(
            btnStartOverRecover,
            'Are you sure?',
            'All recovered data will be lost forever. This action cannot be undone.'
        );

        // Online Status Listeners
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        // DOMContentLoaded Listener (App Initialization)
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('creation-date').valueAsDate = new Date();
            
            updateSchemeDescription();
            updateSeedWordInputs();
            updateRecoverSharesInputs();

            updateOnlineStatus();
            // Set initial theme based on user's system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
                toggleTheme();
            }
        });

        // ==========================================================================
        // SECTION 8: UI - THEME TOGGLE & HELPERS
        // ==========================================================================
        
        /**
         * Toggles the 'data-theme' attribute on the body to switch between themes.
         */
        function toggleTheme() {
            const body = document.body;
            const icon = document.getElementById('toggle-icon');
            const text = document.getElementById('toggle-text');
            if (body.getAttribute('data-theme') === 'light') {
                body.removeAttribute('data-theme');
                icon.textContent = '‚òÄÔ∏è';
                text.textContent = 'Light Mode';
            } else {
                body.setAttribute('data-theme', 'light');
                icon.textContent = 'üåô';
                text.textContent = 'Dark Mode';
            }
        }

        /**
         * Checks the browser's online status and updates the UI indicator accordingly.
         */
        function updateOnlineStatus() {
            if (navigator.onLine) {
                connectionStatusEl.textContent = 'YOU ARE ONLINE - STOP NOW!';
                connectionStatusEl.className = 'connection-status online';
            } else {
                connectionStatusEl.textContent = 'no internet detected';
                connectionStatusEl.className = 'connection-status offline';
            }
        }

        // ==========================================================================
        //
    </script>

    <script>
        // ==========================================================================
        // CRYPTO LOGIC (GF(2053) + BIP39)
        // ==========================================================================

        const FIELD_PRIME = 2053;
        const WORDS_PER_ROW = 3;

        function mod(value) {
            const result = value % FIELD_PRIME;
            return result < 0 ? result + FIELD_PRIME : result;
        }

        function modAdd(a, b) {
            return mod(a + b);
        }

        function modSub(a, b) {
            return mod(a - b);
        }

        function modMul(a, b) {
            return mod(a * b);
        }

        function modInv(value) {
            const val = mod(value);
            if (val === 0) {
                throw new Error('Attempted to invert zero in GF(2053).');
            }
            let t = 0;
            let newT = 1;
            let r = FIELD_PRIME;
            let newR = val;
            while (newR !== 0) {
                const quotient = Math.floor(r / newR);
                [t, newT] = [newT, t - quotient * newT];
                [r, newR] = [newR, r - quotient * newR];
            }
            if (r > 1) {
                throw new Error('Value is not invertible in GF(2053).');
            }
            if (t < 0) {
                t += FIELD_PRIME;
            }
            return t;
        }

        function getRandomIntInclusive(max) {
            if (!window.crypto || !window.crypto.getRandomValues) {
                throw new Error('Secure randomness (window.crypto.getRandomValues) is required.');
            }
            const range = max + 1;
            if (range <= 0) {
                throw new Error('Invalid range for randomness.');
            }
            const maxUint32 = 0x100000000;
            const limit = maxUint32 - (maxUint32 % range);
            const buffer = new Uint32Array(1);
            let value;
            do {
                window.crypto.getRandomValues(buffer);
                value = buffer[0];
            } while (value >= limit);
            return value % range;
        }

        function getRandomFieldElement() {
            return getRandomIntInclusive(FIELD_PRIME - 1);
        }

        function randomPolynomial(secret, degree) {
            const coefficients = [mod(secret)];
            for (let i = 0; i < degree; i++) {
                coefficients.push(getRandomFieldElement());
            }
            return coefficients;
        }

        function evaluatePolynomial(coefficients, x) {
            let result = 0;
            const fieldX = mod(x);
            for (let i = coefficients.length - 1; i >= 0; i--) {
                result = modAdd(modMul(result, fieldX), coefficients[i]);
            }
            return result;
        }

        function lagrangeInterpolateAtZero(points) {
            if (!Array.isArray(points) || points.length === 0) {
                throw new Error('Interpolation requires at least one point.');
            }
            let sum = 0;
            for (let j = 0; j < points.length; j++) {
                let numerator = 1;
                let denominator = 1;
                const xj = mod(points[j].x);
                const yj = mod(points[j].y);
                for (let m = 0; m < points.length; m++) {
                    if (m === j) continue;
                    const xm = mod(points[m].x);
                    numerator = modMul(numerator, mod(FIELD_PRIME - xm));
                    denominator = modMul(denominator, modSub(xj, xm));
                }
                const term = modMul(yj, modMul(numerator, modInv(denominator)));
                sum = modAdd(sum, term);
            }
            return sum;
        }

        function sanitizeMnemonic(mnemonic) {
            if (typeof mnemonic !== 'string') {
                throw new Error('Mnemonic must be a string.');
            }
            const normalized = mnemonic.trim().toLowerCase().replace(/\s+/g, ' ');
            if (!normalized) {
                throw new Error('Mnemonic cannot be empty.');
            }
            return normalized;
        }

        function ensureSupportedWordCount(wordCount) {
            if (wordCount !== 12 && wordCount !== 24) {
                throw new Error('This tool currently supports only 12- or 24-word mnemonics.');
            }
        }

        function computeRowChecks(wordIndices) {
            const rowCount = wordIndices.length / WORDS_PER_ROW;
            const checks = [];
            for (let row = 0; row < rowCount; row++) {
                const base = row * WORDS_PER_ROW;
                const sum = modAdd(modAdd(wordIndices[base], wordIndices[base + 1]), wordIndices[base + 2]);
                checks.push(sum);
            }
            return checks;
        }

        function normalizeShareValue(value, label) {
            if (!Number.isInteger(value)) {
                throw new Error(`${label} must be an integer inside GF(2053).`);
            }
            if (value < 0 || value >= FIELD_PRIME) {
                throw new Error(`${label} must be between 0 and ${FIELD_PRIME - 1}.`);
            }
            return value;
        }

        function validateSharesForRecovery(shares, wordCount) {
            const rowCount = wordCount / WORDS_PER_ROW;
            shares.forEach((share, index) => {
                if (!Number.isInteger(share.shareNumber) || share.shareNumber <= 0 || share.shareNumber >= FIELD_PRIME) {
                    throw new Error(`Share #${index + 1} is missing a valid share number (1-${FIELD_PRIME - 1}).`);
                }
                if (!Array.isArray(share.wordShares) || share.wordShares.length !== wordCount) {
                    throw new Error(`Share #${share.shareNumber} does not contain ${wordCount} word values.`);
                }
                if (!Array.isArray(share.checksumShares) || share.checksumShares.length !== rowCount) {
                    throw new Error(`Share #${share.shareNumber} does not contain ${rowCount} checksum values.`);
                }
                if (!Number.isInteger(share.masterVerificationShare)) {
                    throw new Error(`Share #${share.shareNumber} is missing a master verification share.`);
                }
            });
        }

        function ensureShareNumbersDistinct(shares) {
            const seen = new Set();
            for (const share of shares) {
                if (seen.has(share.shareNumber)) {
                    throw new Error('Duplicate share numbers detected.');
                }
                seen.add(share.shareNumber);
            }
        }

        async function splitBip39(mnemonic, k, n, wordlist) {
            if (!Number.isInteger(k) || !Number.isInteger(n)) {
                throw new Error('Threshold (k) and total shares (n) must be integers.');
            }
            if (k < 2) {
                throw new Error('Threshold k must be at least 2.');
            }
            if (k > n) {
                throw new Error('Threshold k cannot exceed n.');
            }
            if (n >= FIELD_PRIME) {
                throw new Error('Total shares (n) must be less than 2053.');
            }
            const normalizedMnemonic = sanitizeMnemonic(mnemonic);
            await validateBIP39Mnemonic(normalizedMnemonic, wordlist);
            const words = normalizedMnemonic.split(' ');
            const wordCount = words.length;
            ensureSupportedWordCount(wordCount);
            const wordIndices = words.map((word) => {
                const index = wordlist.indexOf(word);
                if (index === -1) {
                    throw new Error(`Unknown mnemonic word: "${word}".`);
                }
                return index;
            });
            const checksumSecrets = computeRowChecks(wordIndices);
            const masterSecret = wordIndices.reduce((acc, value) => modAdd(acc, value), 0);
            const degree = k - 1;

            // --- TEMPORARY DEBUG START ---
            // To revert, uncomment the ORIGINAL lines and remove the TEMPORARY DEBUG lines/blocks.
            const debugCoefficients = { words: [], checksums: [], master: null }; // TEMPORARY DEBUG
            // const wordPolynomials = wordIndices.map((secret) => randomPolynomial(secret, degree)); // ORIGINAL
            const wordPolynomials = wordIndices.map((secret) => { // TEMPORARY DEBUG
                const poly = randomPolynomial(secret, degree); // TEMPORARY DEBUG
                debugCoefficients.words.push(poly.slice(1)); // TEMPORARY DEBUG
                return poly; // TEMPORARY DEBUG
            }); // TEMPORARY DEBUG
            // const checksumPolynomials = checksumSecrets.map((secret) => randomPolynomial(secret, degree)); // ORIGINAL
            const checksumPolynomials = checksumSecrets.map((secret) => { // TEMPORARY DEBUG
                const poly = randomPolynomial(secret, degree); // TEMPORARY DEBUG
                debugCoefficients.checksums.push(poly.slice(1)); // TEMPORARY DEBUG
                return poly; // TEMPORARY DEBUG
            }); // TEMPORARY DEBUG
            // const masterPolynomial = randomPolynomial(masterSecret, degree); // ORIGINAL
            const masterPolynomial = randomPolynomial(masterSecret, degree); // TEMPORARY DEBUG
            debugCoefficients.master = masterPolynomial.slice(1); // TEMPORARY DEBUG
            // --- TEMPORARY DEBUG END ---
            
            const shares = [];
            for (let shareIndex = 1; shareIndex <= n; shareIndex++) {
                const share = {
                    shareNumber: shareIndex,
                    wordShares: [],
                    checksumShares: [],
                    masterVerificationShare: 0
                };
                for (const polynomial of wordPolynomials) {
                    share.wordShares.push(evaluatePolynomial(polynomial, shareIndex));
                }
                for (const polynomial of checksumPolynomials) {
                    share.checksumShares.push(evaluatePolynomial(polynomial, shareIndex));
                }
                share.masterVerificationShare = evaluatePolynomial(masterPolynomial, shareIndex);
                shares.push(share);
            }
            // return { shares }; // ORIGINAL
            return { shares, debugCoefficients }; // TEMPORARY DEBUG
        }

        async function recoverBip39(shares, wordCount, wordlist) {
            if (!Array.isArray(shares) || shares.length < 2) {
                throw new Error('At least two shares are required for recovery.');
            }
            ensureSupportedWordCount(wordCount);
            if (wordCount % WORDS_PER_ROW !== 0) {
                throw new Error('Word count must be divisible by 3.');
            }
            validateSharesForRecovery(shares, wordCount);
            ensureShareNumbersDistinct(shares);
            const rowCount = wordCount / WORDS_PER_ROW;
            const recoveredWords = [];
            for (let i = 0; i < wordCount; i++) {
                const points = shares.map((share) => ({
                    x: mod(share.shareNumber),
                    y: normalizeShareValue(share.wordShares[i], `Word share #${i + 1} (share ${share.shareNumber})`)
                }));
                recoveredWords.push(lagrangeInterpolateAtZero(points));
            }
            const recoveredChecks = [];
            for (let row = 0; row < rowCount; row++) {
                const points = shares.map((share) => ({
                    x: mod(share.shareNumber),
                    y: normalizeShareValue(share.checksumShares[row], `Checksum share C${row + 1} (share ${share.shareNumber})`)
                }));
                recoveredChecks.push(lagrangeInterpolateAtZero(points));
            }
            const recomputedChecks = computeRowChecks(recoveredWords);
            for (let row = 0; row < rowCount; row++) {
                if (recoveredChecks[row] !== recomputedChecks[row]) {
                    throw new ChecksumError(`Checksum verification failed for row ${row + 1}.`, row);
                }
            }
            const masterPoints = shares.map((share) => ({
                x: mod(share.shareNumber),
                y: normalizeShareValue(share.masterVerificationShare, `Master verification (share ${share.shareNumber})`)
            }));
            const recoveredMaster = lagrangeInterpolateAtZero(masterPoints);
            const recomputedMaster = recoveredWords.reduce((acc, value) => modAdd(acc, value), 0);
            if (recoveredMaster !== recomputedMaster) {
                throw new Error('Master verification number mismatch. Please double-check the input shares.');
            }
            recoveredWords.forEach((value, index) => {
                if (value < 0 || value >= 2048) {
                    throw new Error(`Recovered word #${index + 1} is outside the BIP39 range (0‚Äì2047).`);
                }
            });
            const mnemonic = recoveredWords.map((index) => wordlist[index]).join(' ');
            await validateBIP39Mnemonic(mnemonic, wordlist);
            return mnemonic;
        }

        function bytesToBinary(bytes) {
            return Array.from(bytes).map((b) => b.toString(2).padStart(8, '0')).join('');
        }

        async function computeSha256(data) {
            if (typeof sha256 !== 'function' || typeof sha256.arrayBuffer !== 'function') {
                throw new Error('Embedded SHA-256 implementation is not available.');
            }
            return new Uint8Array(sha256.arrayBuffer(data));
        }

        async function validateBIP39Mnemonic(mnemonic, wordlist) {
            const words = mnemonic.trim().split(/\s+/);
            const wordCount = words.length;
            if (wordCount % 3 !== 0 || wordCount < 12 || wordCount > 24) {
                throw new Error(`Invalid mnemonic length: expected 12, 15, 18, 21, or 24 words, received ${wordCount}.`);
            }
            let binaryMnemonic = '';
            for (const word of words) {
                const index = wordlist.indexOf(word);
                if (index === -1) {
                    throw new Error(`Invalid mnemonic word: "${word}" is not in the BIP39 list.`);
                }
                binaryMnemonic += index.toString(2).padStart(11, '0');
            }
            const entropyBits = (wordCount * 11) - (wordCount / 3);
            const checksumLength = wordCount / 3;
            const entropyBinary = binaryMnemonic.substring(0, entropyBits);
            const checksumBinary = binaryMnemonic.substring(entropyBits);
            const entropyBytes = new Uint8Array(entropyBits / 8);
            for (let i = 0; i < (entropyBits / 8); i++) {
                const byteString = entropyBinary.substr(i * 8, 8);
                entropyBytes[i] = parseInt(byteString, 2);
            }
            const hashBytes = await computeSha256(entropyBytes);
            const hashBinary = bytesToBinary(hashBytes);
            const derivedChecksum = hashBinary.substring(0, checksumLength);
            if (derivedChecksum !== checksumBinary) {
                throw new Error('Mnemonic checksum is invalid.');
            }
            return true;
        }

        // BIP39 English wordlist (2048 words)
        const BIP39_WORDLIST = [
            "abandon",
            "ability",
            "able",
            "about",
            "above",
            "absent",
            "absorb",
            "abstract",
            "absurd",
            "abuse",
            "access",
            "accident",
            "account",
            "accuse",
            "achieve",
            "acid",
            "acoustic",
            "acquire",
            "across",
            "act",
            "action",
            "actor",
            "actress",
            "actual",
            "adapt",
            "add",
            "addict",
            "address",
            "adjust",
            "admit",
            "adult",
            "advance",
            "advice",
            "aerobic",
            "affair",
            "afford",
            "afraid",
            "again",
            "age",
            "agent",
            "agree",
            "ahead",
            "aim",
            "air",
            "airport",
            "aisle",
            "alarm",
            "album",
            "alcohol",
            "alert",
            "alien",
            "all",
            "alley",
            "allow",
            "almost",
            "alone",
            "alpha",
            "already",
            "also",
            "alter",
            "always",
            "amateur",
            "amazing",
            "among",
            "amount",
            "amused",
            "analyst",
            "anchor",
            "ancient",
            "anger",
            "angle",
            "angry",
            "animal",
            "ankle",
            "announce",
            "annual",
            "another",
            "answer",
            "antenna",
            "antique",
            "anxiety",
            "any",
            "apart",
            "apology",
            "appear",
            "apple",
            "approve",
            "april",
            "arch",
            "arctic",
            "area",
            "arena",
            "argue",
            "arm",
            "armed",
            "armor",
            "army",
            "around",
            "arrange",
            "arrest",
            "arrive",
            "arrow",
            "art",
            "artefact",
            "artist",
            "artwork",
            "ask",
            "aspect",
            "assault",
            "asset",
            "assist",
            "assume",
            "asthma",
            "athlete",
            "atom",
            "attack",
            "attend",
            "attitude",
            "attract",
            "auction",
            "audit",
            "august",
            "aunt",
            "author",
            "auto",
            "autumn",
            "average",
            "avocado",
            "avoid",
            "awake",
            "aware",
            "away",
            "awesome",
            "awful",
            "awkward",
            "axis",
            "baby",
            "bachelor",
            "bacon",
            "badge",
            "bag",
            "balance",
            "balcony",
            "ball",
            "bamboo",
            "banana",
            "banner",
            "bar",
            "barely",
            "bargain",
            "barrel",
            "base",
            "basic",
            "basket",
            "battle",
            "beach",
            "bean",
            "beauty",
            "because",
            "become",
            "beef",
            "before",
            "begin",
            "behave",
            "behind",
            "believe",
            "below",
            "belt",
            "bench",
            "benefit",
            "best",
            "betray",
            "better",
            "between",
            "beyond",
            "bicycle",
            "bid",
            "bike",
            "bind",
            "biology",
            "bird",
            "birth",
            "bitter",
            "black",
            "blade",
            "blame",
            "blanket",
            "blast",
            "bleak",
            "bless",
            "blind",
            "blood",
            "blossom",
            "blouse",
            "blue",
            "blur",
            "blush",
            "board",
            "boat",
            "body",
            "boil",
            "bomb",
            "bone",
            "bonus",
            "book",
            "boost",
            "border",
            "boring",
            "borrow",
            "boss",
            "bottom",
            "bounce",
            "box",
            "boy",
            "bracket",
            "brain",
            "brand",
            "brass",
            "brave",
            "bread",
            "breeze",
            "brick",
            "bridge",
            "brief",
            "bright",
            "bring",
            "brisk",
            "broccoli",
            "broken",
            "bronze",
            "broom",
            "brother",
            "brown",
            "brush",
            "bubble",
            "buddy",
            "budget",
            "buffalo",
            "build",
            "bulb",
            "bulk",
            "bullet",
            "bundle",
            "bunker",
            "burden",
            "burger",
            "burst",
            "bus",
            "business",
            "busy",
            "butter",
            "buyer",
            "buzz",
            "cabbage",
            "cabin",
            "cable",
            "cactus",
            "cage",
            "cake",
            "call",
            "calm",
            "camera",
            "camp",
            "can",
            "canal",
            "cancel",
            "candy",
            "cannon",
            "canoe",
            "canvas",
            "canyon",
            "capable",
            "capital",
            "captain",
            "car",
            "carbon",
            "card",
            "cargo",
            "carpet",
            "carry",
            "cart",
            "case",
            "cash",
            "casino",
            "castle",
            "casual",
            "cat",
            "catalog",
            "catch",
            "category",
            "cattle",
            "caught",
            "cause",
            "caution",
            "cave",
            "ceiling",
            "celery",
            "cement",
            "census",
            "century",
            "cereal",
            "certain",
            "chair",
            "chalk",
            "champion",
            "change",
            "chaos",
            "chapter",
            "charge",
            "chase",
            "chat",
            "cheap",
            "check",
            "cheese",
            "chef",
            "cherry",
            "chest",
            "chicken",
            "chief",
            "child",
            "chimney",
            "choice",
            "choose",
            "chronic",
            "chuckle",
            "chunk",
            "churn",
            "cigar",
            "cinnamon",
            "circle",
            "citizen",
            "city",
            "civil",
            "claim",
            "clap",
            "clarify",
            "claw",
            "clay",
            "clean",
            "clerk",
            "clever",
            "click",
            "client",
            "cliff",
            "climb",
            "clinic",
            "clip",
            "clock",
            "clog",
            "close",
            "cloth",
            "cloud",
            "clown",
            "club",
            "clump",
            "cluster",
            "clutch",
            "coach",
            "coast",
            "coconut",
            "code",
            "coffee",
            "coil",
            "coin",
            "collect",
            "color",
            "column",
            "combine",
            "come",
            "comfort",
            "comic",
            "common",
            "company",
            "concert",
            "conduct",
            "confirm",
            "congress",
            "connect",
            "consider",
            "control",
            "convince",
            "cook",
            "cool",
            "copper",
            "copy",
            "coral",
            "core",
            "corn",
            "correct",
            "cost",
            "cotton",
            "couch",
            "country",
            "couple",
            "course",
            "cousin",
            "cover",
            "coyote",
            "crack",
            "cradle",
            "craft",
            "cram",
            "crane",
            "crash",
            "crater",
            "crawl",
            "crazy",
            "cream",
            "credit",
            "creek",
            "crew",
            "cricket",
            "crime",
            "crisp",
            "critic",
            "crop",
            "cross",
            "crouch",
            "crowd",
            "crucial",
            "cruel",
            "cruise",
            "crumble",
            "crunch",
            "crush",
            "cry",
            "crystal",
            "cube",
            "culture",
            "cup",
            "cupboard",
            "curious",
            "current",
            "curtain",
            "curve",
            "cushion",
            "custom",
            "cute",
            "cycle",
            "dad",
            "damage",
            "damp",
            "dance",
            "danger",
            "daring",
            "dash",
            "daughter",
            "dawn",
            "day",
            "deal",
            "debate",
            "debris",
            "decade",
            "december",
            "decide",
            "decline",
            "decorate",
            "decrease",
            "deer",
            "defense",
            "define",
            "defy",
            "degree",
            "delay",
            "deliver",
            "demand",
            "demise",
            "denial",
            "dentist",
            "deny",
            "depart",
            "depend",
            "deposit",
            "depth",
            "deputy",
            "derive",
            "describe",
            "desert",
            "design",
            "desk",
            "despair",
            "destroy",
            "detail",
            "detect",
            "develop",
            "device",
            "devote",
            "diagram",
            "dial",
            "diamond",
            "diary",
            "dice",
            "diesel",
            "diet",
            "differ",
            "digital",
            "dignity",
            "dilemma",
            "dinner",
            "dinosaur",
            "direct",
            "dirt",
            "disagree",
            "discover",
            "disease",
            "dish",
            "dismiss",
            "disorder",
            "display",
            "distance",
            "divert",
            "divide",
            "divorce",
            "dizzy",
            "doctor",
            "document",
            "dog",
            "doll",
            "dolphin",
            "domain",
            "donate",
            "donkey",
            "donor",
            "door",
            "dose",
            "double",
            "dove",
            "draft",
            "dragon",
            "drama",
            "drastic",
            "draw",
            "dream",
            "dress",
            "drift",
            "drill",
            "drink",
            "drip",
            "drive",
            "drop",
            "drum",
            "dry",
            "duck",
            "dumb",
            "dune",
            "during",
            "dust",
            "dutch",
            "duty",
            "dwarf",
            "dynamic",
            "eager",
            "eagle",
            "early",
            "earn",
            "earth",
            "easily",
            "east",
            "easy",
            "echo",
            "ecology",
            "economy",
            "edge",
            "edit",
            "educate",
            "effort",
            "egg",
            "eight",
            "either",
            "elbow",
            "elder",
            "electric",
            "elegant",
            "element",
            "elephant",
            "elevator",
            "elite",
            "else",
            "embark",
            "embody",
            "embrace",
            "emerge",
            "emotion",
            "employ",
            "empower",
            "empty",
            "enable",
            "enact",
            "end",
            "endless",
            "endorse",
            "enemy",
            "energy",
            "enforce",
            "engage",
            "engine",
            "enhance",
            "enjoy",
            "enlist",
            "enough",
            "enrich",
            "enroll",
            "ensure",
            "enter",
            "entire",
            "entry",
            "envelope",
            "episode",
            "equal",
            "equip",
            "era",
            "erase",
            "erode",
            "erosion",
            "error",
            "erupt",
            "escape",
            "essay",
            "essence",
            "estate",
            "eternal",
            "ethics",
            "evidence",
            "evil",
            "evoke",
            "evolve",
            "exact",
            "example",
            "excess",
            "exchange",
            "excite",
            "exclude",
            "excuse",
            "execute",
            "exercise",
            "exhaust",
            "exhibit",
            "exile",
            "exist",
            "exit",
            "exotic",
            "expand",
            "expect",
            "expire",
            "explain",
            "expose",
            "express",
            "extend",
            "extra",
            "eye",
            "eyebrow",
            "fabric",
            "face",
            "faculty",
            "fade",
            "faint",
            "faith",
            "fall",
            "false",
            "fame",
            "family",
            "famous",
            "fan",
            "fancy",
            "fantasy",
            "farm",
            "fashion",
            "fat",
            "fatal",
            "father",
            "fatigue",
            "fault",
            "favorite",
            "feature",
            "february",
            "federal",
            "fee",
            "feed",
            "feel",
            "female",
            "fence",
            "festival",
            "fetch",
            "fever",
            "few",
            "fiber",
            "fiction",
            "field",
            "figure",
            "file",
            "film",
            "filter",
            "final",
            "find",
            "fine",
            "finger",
            "finish",
            "fire",
            "firm",
            "first",
            "fiscal",
            "fish",
            "fit",
            "fitness",
            "fix",
            "flag",
            "flame",
            "flash",
            "flat",
            "flavor",
            "flee",
            "flight",
            "flip",
            "float",
            "flock",
            "floor",
            "flower",
            "fluid",
            "flush",
            "fly",
            "foam",
            "focus",
            "fog",
            "foil",
            "fold",
            "follow",
            "food",
            "foot",
            "force",
            "forest",
            "forget",
            "fork",
            "fortune",
            "forum",
            "forward",
            "fossil",
            "foster",
            "found",
            "fox",
            "fragile",
            "frame",
            "frequent",
            "fresh",
            "friend",
            "fringe",
            "frog",
            "front",
            "frost",
            "frown",
            "frozen",
            "fruit",
            "fuel",
            "fun",
            "funny",
            "furnace",
            "fury",
            "future",
            "gadget",
            "gain",
            "galaxy",
            "gallery",
            "game",
            "gap",
            "garage",
            "garbage",
            "garden",
            "garlic",
            "garment",
            "gas",
            "gasp",
            "gate",
            "gather",
            "gauge",
            "gaze",
            "general",
            "genius",
            "genre",
            "gentle",
            "genuine",
            "gesture",
            "ghost",
            "giant",
            "gift",
            "giggle",
            "ginger",
            "giraffe",
            "girl",
            "give",
            "glad",
            "glance",
            "glare",
            "glass",
            "glide",
            "glimpse",
            "globe",
            "gloom",
            "glory",
            "glove",
            "glow",
            "glue",
            "goat",
            "goddess",
            "gold",
            "good",
            "goose",
            "gorilla",
            "gospel",
            "gossip",
            "govern",
            "gown",
            "grab",
            "grace",
            "grain",
            "grant",
            "grape",
            "grass",
            "gravity",
            "great",
            "green",
            "grid",
            "grief",
            "grit",
            "grocery",
            "group",
            "grow",
            "grunt",
            "guard",
            "guess",
            "guide",
            "guilt",
            "guitar",
            "gun",
            "gym",
            "habit",
            "hair",
            "half",
            "hammer",
            "hamster",
            "hand",
            "happy",
            "harbor",
            "hard",
            "harsh",
            "harvest",
            "hat",
            "have",
            "hawk",
            "hazard",
            "head",
            "health",
            "heart",
            "heavy",
            "hedgehog",
            "height",
            "hello",
            "helmet",
            "help",
            "hen",
            "hero",
            "hidden",
            "high",
            "hill",
            "hint",
            "hip",
            "hire",
            "history",
            "hobby",
            "hockey",
            "hold",
            "hole",
            "holiday",
            "hollow",
            "home",
            "honey",
            "hood",
            "hope",
            "horn",
            "horror",
            "horse",
            "hospital",
            "host",
            "hotel",
            "hour",
            "hover",
            "hub",
            "huge",
            "human",
            "humble",
            "humor",
            "hundred",
            "hungry",
            "hunt",
            "hurdle",
            "hurry",
            "hurt",
            "husband",
            "hybrid",
            "ice",
            "icon",
            "idea",
            "identify",
            "idle",
            "ignore",
            "ill",
            "illegal",
            "illness",
            "image",
            "imitate",
            "immense",
            "immune",
            "impact",
            "impose",
            "improve",
            "impulse",
            "inch",
            "include",
            "income",
            "increase",
            "index",
            "indicate",
            "indoor",
            "industry",
            "infant",
            "inflict",
            "inform",
            "inhale",
            "inherit",
            "initial",
            "inject",
            "injury",
            "inmate",
            "inner",
            "innocent",
            "input",
            "inquiry",
            "insane",
            "insect",
            "inside",
            "inspire",
            "install",
            "intact",
            "interest",
            "into",
            "invest",
            "invite",
            "involve",
            "iron",
            "island",
            "isolate",
            "issue",
            "item",
            "ivory",
            "jacket",
            "jaguar",
            "jar",
            "jazz",
            "jealous",
            "jeans",
            "jelly",
            "jewel",
            "job",
            "join",
            "joke",
            "journey",
            "joy",
            "judge",
            "juice",
            "jump",
            "jungle",
            "junior",
            "junk",
            "just",
            "kangaroo",
            "keen",
            "keep",
            "ketchup",
            "key",
            "kick",
            "kid",
            "kidney",
            "kind",
            "kingdom",
            "kiss",
            "kit",
            "kitchen",
            "kite",
            "kitten",
            "kiwi",
            "knee",
            "knife",
            "knock",
            "know",
            "lab",
            "label",
            "labor",
            "ladder",
            "lady",
            "lake",
            "lamp",
            "language",
            "laptop",
            "large",
            "later",
            "latin",
            "laugh",
            "laundry",
            "lava",
            "law",
            "lawn",
            "lawsuit",
            "layer",
            "lazy",
            "leader",
            "leaf",
            "learn",
            "leave",
            "lecture",
            "left",
            "leg",
            "legal",
            "legend",
            "leisure",
            "lemon",
            "lend",
            "length",
            "lens",
            "leopard",
            "lesson",
            "letter",
            "level",
            "liar",
            "liberty",
            "library",
            "license",
            "life",
            "lift",
            "light",
            "like",
            "limb",
            "limit",
            "link",
            "lion",
            "liquid",
            "list",
            "little",
            "live",
            "lizard",
            "load",
            "loan",
            "lobster",
            "local",
            "lock",
            "logic",
            "lonely",
            "long",
            "loop",
            "lottery",
            "loud",
            "lounge",
            "love",
            "loyal",
            "lucky",
            "luggage",
            "lumber",
            "lunar",
            "lunch",
            "luxury",
            "lyrics",
            "machine",
            "mad",
            "magic",
            "magnet",
            "maid",
            "mail",
            "main",
            "major",
            "make",
            "mammal",
            "man",
            "manage",
            "mandate",
            "mango",
            "mansion",
            "manual",
            "maple",
            "marble",
            "march",
            "margin",
            "marine",
            "market",
            "marriage",
            "mask",
            "mass",
            "master",
            "match",
            "material",
            "math",
            "matrix",
            "matter",
            "maximum",
            "maze",
            "meadow",
            "mean",
            "measure",
            "meat",
            "mechanic",
            "medal",
            "media",
            "melody",
            "melt",
            "member",
            "memory",
            "mention",
            "menu",
            "mercy",
            "merge",
            "merit",
            "merry",
            "mesh",
            "message",
            "metal",
            "method",
            "middle",
            "midnight",
            "milk",
            "million",
            "mimic",
            "mind",
            "minimum",
            "minor",
            "minute",
            "miracle",
            "mirror",
            "misery",
            "miss",
            "mistake",
            "mix",
            "mixed",
            "mixture",
            "mobile",
            "model",
            "modify",
            "mom",
            "moment",
            "monitor",
            "monkey",
            "monster",
            "month",
            "moon",
            "moral",
            "more",
            "morning",
            "mosquito",
            "mother",
            "motion",
            "motor",
            "mountain",
            "mouse",
            "move",
            "movie",
            "much",
            "muffin",
            "mule",
            "multiply",
            "muscle",
            "museum",
            "mushroom",
            "music",
            "must",
            "mutual",
            "myself",
            "mystery",
            "myth",
            "naive",
            "name",
            "napkin",
            "narrow",
            "nasty",
            "nation",
            "nature",
            "near",
            "neck",
            "need",
            "negative",
            "neglect",
            "neither",
            "nephew",
            "nerve",
            "nest",
            "net",
            "network",
            "neutral",
            "never",
            "news",
            "next",
            "nice",
            "night",
            "noble",
            "noise",
            "nominee",
            "noodle",
            "normal",
            "north",
            "nose",
            "notable",
            "note",
            "nothing",
            "notice",
            "novel",
            "now",
            "nuclear",
            "number",
            "nurse",
            "nut",
            "oak",
            "obey",
            "object",
            "oblige",
            "obscure",
            "observe",
            "obtain",
            "obvious",
            "occur",
            "ocean",
            "october",
            "odor",
            "off",
            "offer",
            "office",
            "often",
            "oil",
            "okay",
            "old",
            "olive",
            "olympic",
            "omit",
            "once",
            "one",
            "onion",
            "online",
            "only",
            "open",
            "opera",
            "opinion",
            "oppose",
            "option",
            "orange",
            "orbit",
            "orchard",
            "order",
            "ordinary",
            "organ",
            "orient",
            "original",
            "orphan",
            "ostrich",
            "other",
            "outdoor",
            "outer",
            "output",
            "outside",
            "oval",
            "oven",
            "over",
            "own",
            "owner",
            "oxygen",
            "oyster",
            "ozone",
            "pact",
            "paddle",
            "page",
            "pair",
            "palace",
            "palm",
            "panda",
            "panel",
            "panic",
            "panther",
            "paper",
            "parade",
            "parent",
            "park",
            "parrot",
            "party",
            "pass",
            "patch",
            "path",
            "patient",
            "patrol",
            "pattern",
            "pause",
            "pave",
            "payment",
            "peace",
            "peanut",
            "pear",
            "peasant",
            "pelican",
            "pen",
            "penalty",
            "pencil",
            "people",
            "pepper",
            "perfect",
            "permit",
            "person",
            "pet",
            "phone",
            "photo",
            "phrase",
            "physical",
            "piano",
            "picnic",
            "picture",
            "piece",
            "pig",
            "pigeon",
            "pill",
            "pilot",
            "pink",
            "pioneer",
            "pipe",
            "pistol",
            "pitch",
            "pizza",
            "place",
            "planet",
            "plastic",
            "plate",
            "play",
            "please",
            "pledge",
            "pluck",
            "plug",
            "plunge",
            "poem",
            "poet",
            "point",
            "polar",
            "pole",
            "police",
            "pond",
            "pony",
            "pool",
            "popular",
            "portion",
            "position",
            "possible",
            "post",
            "potato",
            "pottery",
            "poverty",
            "powder",
            "power",
            "practice",
            "praise",
            "predict",
            "prefer",
            "prepare",
            "present",
            "pretty",
            "prevent",
            "price",
            "pride",
            "primary",
            "print",
            "priority",
            "prison",
            "private",
            "prize",
            "problem",
            "process",
            "produce",
            "profit",
            "program",
            "project",
            "promote",
            "proof",
            "property",
            "prosper",
            "protect",
            "proud",
            "provide",
            "public",
            "pudding",
            "pull",
            "pulp",
            "pulse",
            "pumpkin",
            "punch",
            "pupil",
            "puppy",
            "purchase",
            "purity",
            "purpose",
            "purse",
            "push",
            "put",
            "puzzle",
            "pyramid",
            "quality",
            "quantum",
            "quarter",
            "question",
            "quick",
            "quit",
            "quiz",
            "quote",
            "rabbit",
            "raccoon",
            "race",
            "rack",
            "radar",
            "radio",
            "rail",
            "rain",
            "raise",
            "rally",
            "ramp",
            "ranch",
            "random",
            "range",
            "rapid",
            "rare",
            "rate",
            "rather",
            "raven",
            "raw",
            "razor",
            "ready",
            "real",
            "reason",
            "rebel",
            "rebuild",
            "recall",
            "receive",
            "recipe",
            "record",
            "recycle",
            "reduce",
            "reflect",
            "reform",
            "refuse",
            "region",
            "regret",
            "regular",
            "reject",
            "relax",
            "release",
            "relief",
            "rely",
            "remain",
            "remember",
            "remind",
            "remove",
            "render",
            "renew",
            "rent",
            "reopen",
            "repair",
            "repeat",
            "replace",
            "report",
            "require",
            "rescue",
            "resemble",
            "resist",
            "resource",
            "response",
            "result",
            "retire",
            "retreat",
            "return",
            "reunion",
            "reveal",
            "review",
            "reward",
            "rhythm",
            "rib",
            "ribbon",
            "rice",
            "rich",
            "ride",
            "ridge",
            "rifle",
            "right",
            "rigid",
            "ring",
            "riot",
            "ripple",
            "risk",
            "ritual",
            "rival",
            "river",
            "road",
            "roast",
            "robot",
            "robust",
            "rocket",
            "romance",
            "roof",
            "rookie",
            "room",
            "rose",
            "rotate",
            "rough",
            "round",
            "route",
            "royal",
            "rubber",
            "rude",
            "rug",
            "rule",
            "run",
            "runway",
            "rural",
            "sad",
            "saddle",
            "sadness",
            "safe",
            "sail",
            "salad",
            "salmon",
            "salon",
            "salt",
            "salute",
            "same",
            "sample",
            "sand",
            "satisfy",
            "satoshi",
            "sauce",
            "sausage",
            "save",
            "say",
            "scale",
            "scan",
            "scare",
            "scatter",
            "scene",
            "scheme",
            "school",
            "science",
            "scissors",
            "scorpion",
            "scout",
            "scrap",
            "screen",
            "script",
            "scrub",
            "sea",
            "search",
            "season",
            "seat",
            "second",
            "secret",
            "section",
            "security",
            "seed",
            "seek",
            "segment",
            "select",
            "sell",
            "seminar",
            "senior",
            "sense",
            "sentence",
            "series",
            "service",
            "session",
            "settle",
            "setup",
            "seven",
            "shadow",
            "shaft",
            "shallow",
            "share",
            "shed",
            "shell",
            "sheriff",
            "shield",
            "shift",
            "shine",
            "ship",
            "shiver",
            "shock",
            "shoe",
            "shoot",
            "shop",
            "short",
            "shoulder",
            "shove",
            "shrimp",
            "shrug",
            "shuffle",
            "shy",
            "sibling",
            "sick",
            "side",
            "siege",
            "sight",
            "sign",
            "silent",
            "silk",
            "silly",
            "silver",
            "similar",
            "simple",
            "since",
            "sing",
            "siren",
            "sister",
            "situate",
            "six",
            "size",
            "skate",
            "sketch",
            "ski",
            "skill",
            "skin",
            "skirt",
            "skull",
            "slab",
            "slam",
            "sleep",
            "slender",
            "slice",
            "slide",
            "slight",
            "slim",
            "slogan",
            "slot",
            "slow",
            "slush",
            "small",
            "smart",
            "smile",
            "smoke",
            "smooth",
            "snack",
            "snake",
            "snap",
            "sniff",
            "snow",
            "soap",
            "soccer",
            "social",
            "sock",
            "soda",
            "soft",
            "solar",
            "soldier",
            "solid",
            "solution",
            "solve",
            "someone",
            "song",
            "soon",
            "sorry",
            "sort",
            "soul",
            "sound",
            "soup",
            "source",
            "south",
            "space",
            "spare",
            "spatial",
            "spawn",
            "speak",
            "special",
            "speed",
            "spell",
            "spend",
            "sphere",
            "spice",
            "spider",
            "spike",
            "spin",
            "spirit",
            "split",
            "spoil",
            "sponsor",
            "spoon",
            "sport",
            "spot",
            "spray",
            "spread",
            "spring",
            "spy",
            "square",
            "squeeze",
            "squirrel",
            "stable",
            "stadium",
            "staff",
            "stage",
            "stairs",
            "stamp",
            "stand",
            "start",
            "state",
            "stay",
            "steak",
            "steel",
            "stem",
            "step",
            "stereo",
            "stick",
            "still",
            "sting",
            "stock",
            "stomach",
            "stone",
            "stool",
            "story",
            "stove",
            "strategy",
            "street",
            "strike",
            "strong",
            "struggle",
            "student",
            "stuff",
            "stumble",
            "style",
            "subject",
            "submit",
            "subway",
            "success",
            "such",
            "sudden",
            "suffer",
            "sugar",
            "suggest",
            "suit",
            "summer",
            "sun",
            "sunny",
            "sunset",
            "super",
            "supply",
            "supreme",
            "sure",
            "surface",
            "surge",
            "surprise",
            "surround",
            "survey",
            "suspect",
            "sustain",
            "swallow",
            "swamp",
            "swap",
            "swarm",
            "swear",
            "sweet",
            "swift",
            "swim",
            "swing",
            "switch",
            "sword",
            "symbol",
            "symptom",
            "syrup",
            "system",
            "table",
            "tackle",
            "tag",
            "tail",
            "talent",
            "talk",
            "tank",
            "tape",
            "target",
            "task",
            "taste",
            "tattoo",
            "taxi",
            "teach",
            "team",
            "tell",
            "ten",
            "tenant",
            "tennis",
            "tent",
            "term",
            "test",
            "text",
            "thank",
            "that",
            "theme",
            "then",
            "theory",
            "there",
            "they",
            "thing",
            "this",
            "thought",
            "three",
            "thrive",
            "throw",
            "thumb",
            "thunder",
            "ticket",
            "tide",
            "tiger",
            "tilt",
            "timber",
            "time",
            "tiny",
            "tip",
            "tired",
            "tissue",
            "title",
            "toast",
            "tobacco",
            "today",
            "toddler",
            "toe",
            "together",
            "toilet",
            "token",
            "tomato",
            "tomorrow",
            "tone",
            "tongue",
            "tonight",
            "tool",
            "tooth",
            "top",
            "topic",
            "topple",
            "torch",
            "tornado",
            "tortoise",
            "toss",
            "total",
            "tourist",
            "toward",
            "tower",
            "town",
            "toy",
            "track",
            "trade",
            "traffic",
            "tragic",
            "train",
            "transfer",
            "trap",
            "trash",
            "travel",
            "tray",
            "treat",
            "tree",
            "trend",
            "trial",
            "tribe",
            "trick",
            "trigger",
            "trim",
            "trip",
            "trophy",
            "trouble",
            "truck",
            "true",
            "truly",
            "trumpet",
            "trust",
            "truth",
            "try",
            "tube",
            "tuition",
            "tumble",
            "tuna",
            "tunnel",
            "turkey",
            "turn",
            "turtle",
            "twelve",
            "twenty",
            "twice",
            "twin",
            "twist",
            "two",
            "type",
            "typical",
            "ugly",
            "umbrella",
            "unable",
            "unaware",
            "uncle",
            "uncover",
            "under",
            "undo",
            "unfair",
            "unfold",
            "unhappy",
            "uniform",
            "unique",
            "unit",
            "universe",
            "unknown",
            "unlock",
            "until",
            "unusual",
            "unveil",
            "update",
            "upgrade",
            "uphold",
            "upon",
            "upper",
            "upset",
            "urban",
            "urge",
            "usage",
            "use",
            "used",
            "useful",
            "useless",
            "usual",
            "utility",
            "vacant",
            "vacuum",
            "vague",
            "valid",
            "valley",
            "valve",
            "van",
            "vanish",
            "vapor",
            "various",
            "vast",
            "vault",
            "vehicle",
            "velvet",
            "vendor",
            "venture",
            "venue",
            "verb",
            "verify",
            "version",
            "very",
            "vessel",
            "veteran",
            "viable",
            "vibrant",
            "vicious",
            "victory",
            "video",
            "view",
            "village",
            "vintage",
            "violin",
            "virtual",
            "virus",
            "visa",
            "visit",
            "visual",
            "vital",
            "vivid",
            "vocal",
            "voice",
            "void",
            "volcano",
            "volume",
            "vote",
            "voyage",
            "wage",
            "wagon",
            "wait",
            "walk",
            "wall",
            "walnut",
            "want",
            "warfare",
            "warm",
            "warrior",
            "wash",
            "wasp",
            "waste",
            "water",
            "wave",
            "way",
            "wealth",
            "weapon",
            "wear",
            "weasel",
            "weather",
            "web",
            "wedding",
            "weekend",
            "weird",
            "welcome",
            "west",
            "wet",
            "whale",
            "what",
            "wheat",
            "wheel",
            "when",
            "where",
            "whip",
            "whisper",
            "wide",
            "width",
            "wife",
            "wild",
            "will",
            "win",
            "window",
            "wine",
            "wing",
            "wink",
            "winner",
            "winter",
            "wire",
            "wisdom",
            "wise",
            "wish",
            "witness",
            "wolf",
            "woman",
            "wonder",
            "wood",
            "wool",
            "word",
            "work",
            "world",
            "worry",
            "worth",
            "wrap",
            "wreck",
            "wrestle",
            "wrist",
            "write",
            "wrong",
            "yard",
            "year",
            "yellow",
            "you",
            "young",
            "youth",
            "zebra",
            "zero",
            "zone",
            "zoo"
        ];
    </script>
</body>
</html>
